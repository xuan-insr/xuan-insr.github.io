
:::info
**æœ¬å·¥ç¨‹æ˜¯ 2021~2022 å­¦å¹´æµ™æ±Ÿå¤§å­¦ã€Šé«˜çº§ç¨‹åºè®¾è®¡ã€‹è¯¾ç¨‹è®¾è®¡**

**ä½œè€…**ï¼šè§£é›²æš„ 3190105871<br />**æœ¬æ–‡é“¾æ¥**ï¼š[https://www.yuque.com/xianyuxuan/coding/xianyuque](https://www.yuque.com/xianyuxuan/coding/xianyuque)
**æœ¬å·¥ç¨‹ GitHub ä»“åº“åœ°å€**ï¼š[https://github.com/smd1121/xianyuque](https://github.com/smd1121/xianyuque)
:::


# 1 è®¾è®¡æ¦‚è¿°

> æœ¬è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ¥è‡ªå¦‚ä¸‹æ¥æºçš„ä¸€äº›å†…å®¹ï¼š
>    - **Editor.md**ï¼Œç”¨äºå®ç° Markdown çš„ç¼–è¾‘å’Œé˜…è¯»ï¼›
>    - è€¿æ™¨æ­Œè€å¸ˆæä¾›çš„ Demo ä¸­çš„éƒ¨åˆ† CSSï¼›
>    - æ–‡æœ« **å‚è€ƒèµ„æ–™** ä¸­çš„ä¸€äº›å®ç°æ€è·¯æˆ–ä»£ç ã€‚
> 
> æœ¬è®¾è®¡å‚è€ƒäº†åŠ©æ•™é™†æ¶›æ¶›è€å¸ˆæä¾›çš„ã€ŠSpringBoot å…¥é—¨ã€‹ã€‚è¯¥æ–‡æ¡£ç»™æˆ‘çš„å…¥é—¨æä¾›äº†å¾ˆå¤§çš„å¸®åŠ©ï¼



## 1.1 é€‰é¢˜åŠåŸºæœ¬åŠŸèƒ½

åŸºäº SpringBoot è®¾è®¡äº†ä¸€ä¸ªç®€å•çš„æ–‡æ¡£ç®¡ç†ç¼–è¾‘å™¨ _**å’¸é±¼é›€ (xianyuque)**_ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š

   - **æ³¨å†Œã€ç™»å½•å’Œä¸ªäººèµ„æ–™ä¿®æ”¹**
      - ä½¿ç”¨ Cookies **ä¿å­˜ç™»å½•çŠ¶æ€**
      - åœ¨æ•°æ®åº“ä¸­ä½¿ç”¨ MD5 ä¿å­˜å¯†ç ï¼Œæä¾›ä¸€å®šçš„ **å®‰å…¨æ€§**
   - **æ–‡æ¡£ç¼–è¾‘ï¼šMarkdown **æ–‡æ¡£çš„é˜…è¯»å’Œç¼–è¾‘ã€å‘å¸ƒ
      - åœ¨è¿›å…¥æ–‡æ¡£é˜…è¯»å’Œç¼–è¾‘é¡µé¢ï¼Œä»¥åŠå‘å¸ƒæ—¶ï¼Œè¿›è¡Œ **æƒé™æ£€æŸ¥**ï¼Œä¿è¯éšç§æ€§
      - **è¯»å†™åˆ†ç¦»**ï¼Œç”¨æˆ·æœªæ‰‹åŠ¨ç‚¹å‡»å‘å¸ƒæ—¶ï¼Œé˜…è¯»é¡µé¢ä»ä¸ºä¸Šä¸€æ¬¡å‘å¸ƒçš„ç»“æœ
         - ç¼–è¾‘é¡µä¸­ **æ¯ 2 åˆ†é’Ÿè‡ªåŠ¨ä¿å­˜** åˆ°ç¼“å­˜
         - ä»ç¼–è¾‘é¡µ **é€€å‡ºæ—¶è‡ªåŠ¨ä¿å­˜** åˆ°ç¼“å­˜
         - ä¸‹ä¸€æ¬¡ **ç¼–è¾‘æ—¶æ¢å¤ç¼“å­˜**
   - **æ–‡æ¡£ç®¡ç†**
      - æ–‡ä»¶çš„åˆ—è¡¨å±•ç¤º
      - æ–‡ä»¶çš„æ–°å¢ã€åˆ é™¤
      - æ–‡ä»¶å½’æ¡£


## 1.2 æ•°æ®åº“æ¨¡å‹è®¾è®¡

æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡å‡ºäº†å¦‚ä¸‹çš„æ•°æ®åº“ç»“æ„ï¼š
![image.png](./assets/1640860162934-a182949c-b5a0-4eed-a95e-e3ff6d862d28.png)
å…¶ä¸­ï¼Œå®ä½“ `Users` ä¿å­˜äº†ç”¨æˆ·çš„ç”¨æˆ·åã€MD5 åŠ å¯†çš„å¯†ç å’Œæ˜µç§°ç­‰ä¿¡æ¯ï¼›`FileInfo` ä¿å­˜äº†æ–‡ä»¶çš„ IDã€æ ‡é¢˜ã€å†…å®¹ã€æœ€è¿‘ä¿®æ”¹æ—¶é—´ç­‰ä¿¡æ¯ã€‚<br />å…³ç³» `VisibleTo` ä¿å­˜äº†æƒé™å…³ç³»ï¼Œ`Editing` ä¿å­˜äº†å ç”¨å…³ç³»ï¼Œ`CacheOf` ä¿å­˜äº†æ–‡ä»¶çš„ç¼“å­˜ï¼ˆç”¨äºè¯»å†™åˆ†ç¦»ï¼‰ï¼Œ`Inside` ä¿å­˜äº†æ–‡ä»¶çš„å½’æ¡£ä¿¡æ¯ï¼Œ`RevisionOf` ä¿å­˜äº†æ–‡ä»¶çš„å†å²ç‰ˆæœ¬ä¿¡æ¯ã€‚

è¿™é‡Œè¯´æ˜ **è¯»å†™åˆ†ç¦»å’Œè‡ªåŠ¨ä¿å­˜çš„å®ç°æ€è·¯**ï¼šå¯¹äºæ¯ä¸€ä¸ªæ–‡æ¡£ï¼Œéƒ½æœ‰ä¸€ä¸ªå‘å¸ƒç‰ˆå’Œç¼“å­˜ç‰ˆï¼Œè¿™ä¸¤ä¸ªç‰ˆæœ¬é€šè¿‡ `CacheOf` å…³ç³»è¿æ¥ã€‚

   - å½“ä¸”ä»…å½“ç”¨æˆ·åœ¨ç¼–è¾‘é¡µé¢ç‚¹å‡»â€œå‘å¸ƒâ€æ—¶ï¼Œå‘å¸ƒç‰ˆæ‰ä¼šè¢«æ›´æ–°ï¼›
   - å½“å‘å¸ƒç‰ˆæ›´æ–°ï¼Œæˆ–è€…ç”¨æˆ·åœ¨ç¼–è¾‘ç•Œé¢æ¯ 2 åˆ†é’Ÿï¼Œæˆ–è€…ç”¨æˆ·é€€å‡ºç¼–è¾‘ç•Œé¢æ—¶ï¼Œç¼“å­˜ç‰ˆä¼šè¢«æ›´æ–°ã€‚

å½“ç”¨æˆ·è¿›å…¥ **ç¼–è¾‘ **é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨å±•ç°çš„å§‹ç»ˆæ˜¯ **ç¼“å­˜ç‰ˆ**ï¼›å½“ç”¨æˆ·è¿›å…¥ **å‘å¸ƒ** é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨å±•ç°çš„å§‹ç»ˆæ˜¯ **å‘å¸ƒç‰ˆ**ã€‚

è¿™ä¸ªæ•°æ®åº“ç»“æ„çš„ DDL (Data Define Language) ä»£ç åœ¨åæ–‡è¯¦ç»†å±•ç¤ºã€‚


## 1.3 åŸºæœ¬åŠŸèƒ½ä¸é€»è¾‘

ä»¥ä¸‹åŠŸèƒ½åœ¨æœ¬åœ°ç¯å›åœ°å€ä¸‹æµ‹è¯•ã€‚


### 1.3.1 åˆå§‹ç•Œé¢ /
åœ¨æµè§ˆå™¨åœ°å€æ é”®å…¥ `localhost:8080`ï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®å½“å‰ request æ˜¯å¦æºå¸¦æœåŠ¡å™¨åˆ†é…çš„ Cookies åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚

   - å¦‚æœæœªç™»å½•ï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢ `/login`ï¼›
   - å¦‚æœå·²ç»ç™»å½•ï¼ŒæœåŠ¡å™¨æ ¹æ® Cookies æ‰¾åˆ°å½“å‰ç”¨æˆ·çš„ IDï¼Œè·³è½¬åˆ°ç”¨æˆ·æ–‡ä»¶åˆ—è¡¨ `/list/{userID}`ã€‚


### 1.3.2 ç™»å½•ç•Œé¢ /login
åœ¨ç™»å½•ç•Œé¢ä¸­ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•ã€‚![image.png](./assets/1640860002859-3a89dabf-612d-4028-bc63-2079425246dd.png)
ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®æ—¶ï¼Œä¼šå‘é€ç›®çš„ä¸º `/login` çš„ POST æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨ä¼šå°†ç”¨æˆ·åå’Œ MD5 åŠ å¯†åçš„å¯†ç ä¸æ•°æ®åº“ä¸­çš„ä¿¡æ¯è¿›è¡Œæ¯”å¯¹ï¼š
![image.png](./assets/1640860625449-f2618932-c0b4-401e-8cd5-ac9931601ab9.png)
å¦‚æœé”™è¯¯ï¼Œä¼šæç¤ºâ€œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯â€æˆ–â€œç”¨æˆ·ä¸å­˜åœ¨â€ï¼š
![image.png](./assets/1640860761746-9677f531-de98-4de1-a272-91334741a64a.png)
å¦‚æœç™»å½•æˆåŠŸï¼ŒæœåŠ¡å™¨ä¼šç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ª Cookieï¼Œè®°å½•å…¶ç™»å½•çŠ¶æ€ï¼Œæœ‰æ•ˆæœŸä¸º 1 å¤©ï¼›ç„¶åè·³è½¬åˆ°ç”¨æˆ·çš„æ–‡ä»¶åˆ—è¡¨ `/list/{userID}`ã€‚

ç”¨æˆ·å¯ä»¥ç‚¹å‡»â€œæ³¨å†Œâ€æŒ‰é’®è·³è½¬åˆ°æ³¨å†Œé¡µé¢ `/register`ã€‚


### 1.3.3 æ³¨å†Œç•Œé¢ /register
![image.png](./assets/1640860931471-c7498ea0-22e6-4764-9b63-96ba36a7198b.png)
ç”¨æˆ·ç‚¹å‡»æ³¨å†ŒæŒ‰é’®æ—¶ï¼Œä¼šå‘ `/register` å‘é€ä¸€ä¸ª POST æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²ç»å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œè¿›è¡Œé”™è¯¯æç¤ºï¼š
![image.png](./assets/1640861610672-28175c30-eec1-463f-af6f-3c902d5b9fe3.png)
å¦‚æœæ²¡æœ‰å†²çªï¼Œåˆ™æˆåŠŸæ³¨å†Œã€‚è·³è½¬åˆ°ç”¨æˆ·æ–‡ä»¶åˆ—è¡¨ `/list/{userID}`ã€‚æ­¤æ—¶ç”±äºåˆ—è¡¨ä¸­æ²¡æœ‰æ–‡ä»¶ï¼Œå› æ­¤è·³è½¬åˆ° `/start` å¼•å¯¼ç”¨æˆ·åˆ›å»ºæ–‡æ¡£ï¼š![image.png](./assets/1640861683787-19e8a1e4-5c8b-4815-a0ef-a43efa1a0b3e.png)
![image.png](./assets/1640861753677-36b4270d-1f85-4c0d-bb0a-3e4112257cd5.png)

### 1.3.4 æ–‡æ¡£åˆ—è¡¨ç•Œé¢ /list/{userID}![image.png](./assets/1640863227098-7dc82f9d-2968-43d4-a16c-5d6b33fd7c98.png)
	æ–‡æ¡£åˆ—è¡¨å±•ç¤ºäº† **å½“å‰ç”¨æˆ·å¯è§** çš„æ‰€æœ‰æ–‡æ¡£çš„æ ‡é¢˜å’Œæœ€æ–°æ›´æ”¹æ—¶é—´ï¼ŒåŒæ—¶å±•ç°äº†å±‚çº§å…³ç³»ã€‚

   - ç”¨æˆ·ç‚¹å‡»â€œæ–°å»ºâ€æ—¶ï¼Œä¼šè·³è½¬åˆ° `/new`ï¼Œå®é™…ä¸ŠæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€å¯¹æ–°çš„æ–‡ä»¶ï¼Œè¿”å› `/edit/{fileID}` è¿›å…¥ç¼–è¾‘é¡µé¢ï¼›
   - ç”¨æˆ·ç‚¹å‡»â€œæˆ‘çš„â€æ—¶ï¼Œä¼šè·³è½¬åˆ°ä¿¡æ¯æ›´æ”¹ç•Œé¢ `/profile`ï¼›
   - ç”¨æˆ·ç‚¹å‡»æŸä¸ªæ–‡æ¡£çš„æ ‡é¢˜æ—¶ï¼Œä¼šè·³è½¬åˆ°å¯¹åº”çš„æ–‡æ¡£é˜…è¯»ç•Œé¢ `/read/{fileID}`ï¼›
   - ç”¨æˆ·ç‚¹å‡»â€œç¼–è¾‘â€æ—¶ï¼Œä¼šè·³è½¬åˆ°å¯¹åº”æ–‡æ¡£çš„ç¼–è¾‘ç•Œé¢ `/edit/{fileID}` ï¼›
   - ç”¨æˆ·ç‚¹å‡»â€œç§»åŠ¨â€æ—¶ï¼Œä¼šè·³è½¬åˆ°å¯¹åº”æ–‡æ¡£çš„ç§»åŠ¨ç•Œé¢ `/move/{fileID}`ï¼›
   - ç”¨æˆ·ç‚¹å‡»â€œåˆ é™¤â€æ—¶ï¼Œæµè§ˆå™¨ä¼šç»™å‡ºæç¤ºï¼Œç”¨æˆ·ç¡®è®¤åè¿›è¡Œåˆ é™¤ã€‚


#### åˆ é™¤åŠŸèƒ½
![image.png](./assets/1640864297527-760ec7aa-ec04-4a23-bd3f-752d9c504806.png)
![image.png](./assets/1640864324041-116c8cbe-cb72-46de-a2ec-8a0475e38fb0.png)


### 1.3.5 ç”¨æˆ·ä¿¡æ¯æ›´æ”¹ç•Œé¢ /profile
![image.png](./assets/1640864386808-21ca0448-d20a-4df7-aa04-7e41c4a6e06d.png)
ç”¨æˆ·å¯ä»¥åœ¨è¿™ä¸ªç•Œé¢æ›´æ–°ä¸ªäººä¿¡æ¯ã€‚ç•™ç©ºåˆ™ä¸æ›´æ–°ã€‚<br />ç”¨æˆ·å¯ä»¥ç‚¹å‡»â€œé€€å‡ºç™»å½•â€ï¼ŒæœåŠ¡å™¨ä¼šåˆ é™¤ä¿å­˜çš„ç”¨æˆ·å½“å‰ Cookieï¼Œç„¶åè·³è½¬åˆ° `/`ï¼Œéšåä¼šå› ä¸ºæœªç™»å½•è·³è½¬åˆ° `/login`ã€‚<br />ç”¨æˆ·ç‚¹å‡»â€œè¿”å›â€ï¼Œä¼šè·³è½¬åˆ° `/`ï¼Œéšåä¼šå› ä¸ºå·²ç™»å½•è·³è½¬åˆ° `/list/{userID}`ã€‚


### 1.3.6 å¼€å§‹å¼•å¯¼ç•Œé¢ /edit/{fileID}
![image.png](./assets/1640865399686-fd9c0a4f-f7da-43d0-8103-aa413608feef.png)

- ç”¨æˆ·ç‚¹å‡»â€œæ–°å»ºæ–‡æ¡£â€ä¼šè·³è½¬åˆ° `/new`ï¼Œç‚¹å‡»â€œæˆ‘çš„â€ä¼šè·³è½¬åˆ° `/profile`ã€‚


### 1.3.7 æ–°å»ºæ–‡æ¡£ /new
ç”¨æˆ·è®¿é—®â€œæ–°å»ºæ–‡æ¡£â€æ—¶ï¼ŒæœåŠ¡å™¨ä¼šé¦–å…ˆæ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼ˆç”¨ Cookiesï¼‰ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•ï¼Œåˆ™è·³è½¬åˆ° `/`ã€‚

å¦‚æˆ‘ä»¬åœ¨ 1.2 ä¸­æ‰€è¯´ï¼Œå½“æˆ‘ä»¬æ–°å»ºæ–‡æ¡£æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ–°å»º 2 ä¸ªæ–‡æ¡£åˆ†åˆ«ä½œä¸ºå‘å¸ƒç‰ˆå’Œç¼“å­˜ç‰ˆã€‚ç„¶åæœåŠ¡å™¨å°†è¿”å›åˆ° `/edit` çš„ forwardï¼Œå¹¶å°†ç¼“å­˜ç‰ˆçš„ä¿¡æ¯ï¼ˆID ç­‰ï¼‰åŠ å…¥åˆ°è¿”å›çš„ ModelAndView ä¸­ã€‚


### 1.3.8 æ–‡æ¡£ç¼–è¾‘ /edit/{fileID}
æœåŠ¡ç«¯ä¼šå¯¹ `edit` çš„ requestï¼ˆåŒ…æ‹¬ GET å’Œ POSTï¼‰è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œå¦‚æœæœ‰æƒé™åˆ™è¿”å›å†…å®¹ã€‚

#### Markdown æ”¯æŒ
æ–‡æ¡£ç¼–è¾‘æ”¯æŒ Markdown æ ‡è®°è¯­è¨€è¯­æ³•ï¼Œå¹¶ä¸”å¯ä»¥å®æ—¶çœ‹åˆ°å¯¹æ¯”ï¼š
![image.png](./assets/1640862808951-4f9b3758-c3b7-41ba-af9b-05e0386f15f1.png)

#### ![image.png](./assets/1640862852004-7f532d33-55c3-4e6f-ba49-216d7673238c.png)
![image.png](./assets/1640867217986-8352aa35-4bdc-46ac-b3c6-c093af544a1e.png)


#### æ›´æ–°é€»è¾‘

- ç”¨æˆ·ç‚¹å‡»â€œå‘å¸ƒâ€æ—¶ï¼Œå‘é€ä¸€ä¸ª POST åˆ° `/publish/{fileID}`ï¼Œæ›´æ–°å¯¹åº”çš„ **å‘å¸ƒç‰ˆ** å’Œ **ç¼“å­˜ç‰ˆ**ï¼›
- æ¯ 120 ç§’ï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨å‘é€ä¸€ä¸ª POST åˆ° `/autoSave/{fileID}`ï¼Œæ›´æ–°å¯¹åº”çš„ **ç¼“å­˜ç‰ˆ**ï¼›
- ç”¨æˆ·å…³é—­é¡µé¢æ—¶ï¼Œå®¢æˆ·ç«¯çš„ `unload` ç›‘å¬å™¨ä¼šè°ƒç”¨æ–¹æ³•å‘é€ä¸€ä¸ª POST åˆ° `/autoSave/{fileID}`ï¼Œæ›´æ–°å¯¹åº”çš„ **ç¼“å­˜ç‰ˆ**ã€‚

![image.png](./assets/1640866924408-fd2c7532-7d94-436e-bf46-b0a7e61b156e.png)


### 1.3.9 æ–‡æ¡£é˜…è¯» /read/{fileID}
![image.png](./assets/1640867012795-e4c80d90-c85d-4af9-bb72-0c9c87589b6d.png)
æœåŠ¡ç«¯ä¼šå¯¹ `read` çš„ request è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œå¦‚æœæœ‰æƒé™åˆ™è¿”å›å†…å®¹ã€‚


### 1.3.10 å½’æ¡£ï¼šç§»åŠ¨æ–‡æ¡£ /move/{fileID}
ç”¨æˆ·ç‚¹å‡»æ–‡æ¡£åˆ—è¡¨ä¸­çš„æŸä¸ªæ–‡æ¡£çš„â€œç§»åŠ¨â€æŒ‰é’®åï¼Œè¿›å…¥ç§»åŠ¨ç•Œé¢ï¼Œé€‰æ‹©å°†è¿™ä¸ªæ–‡æ¡£ç§»åŠ¨åˆ°å“ªä¸ªæ–‡æ¡£çš„å†…éƒ¨ï¼š
![image.png](./assets/1640867386155-c6f5e123-95af-4f2d-bd2b-f6d93504039b.png)
![image.png](./assets/1640867422691-ae3fa46e-db0e-46da-bc91-23733c025e67.png)
![image.png](./assets/1640867450795-6bdeebf8-b366-4203-adfa-923e481c4b06.png)
åœ¨ç”¨æˆ·é€‰æ‹©ç§»åŠ¨ç›®çš„åï¼Œä¼šç»™ `/moveTo/{fileID}/{toFileID}` å‘é€ä¸€ä¸ª POSTï¼Œè¿™æ—¶æœåŠ¡ç«¯ä¼šé¦–å…ˆåˆ¤æ–­ç”¨æˆ·å¯¹è¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦æœ‰æƒé™ï¼Œç„¶ååˆ¤æ–­è¿™ä¸ªç§»åŠ¨æ˜¯å¦åˆæ³•ï¼ˆå³ï¼Œç›®çš„æ–‡ä»¶ä¸èƒ½æ˜¯å½“å‰æ–‡ä»¶ä¸ºæ ¹çš„å­æ ‘ä¸­çš„èŠ‚ç‚¹ï¼›æˆ–è€…è¯´ï¼Œä¸èƒ½æˆç¯ï¼‰ï¼›å¦‚æœåˆæ³•åˆ™è¿›è¡Œç§»åŠ¨ã€‚ç„¶åè·³è½¬å›åˆ—è¡¨ã€‚


### 1.3.11 é”™è¯¯é¡µé¢ /error
![image.png](./assets/1640867647775-bbe752de-163b-49d5-acf5-e9d83ae17a61.png)
å½“ç”¨æˆ·è¯•å›¾è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„é¡µé¢ï¼Œæˆ–è€…è®¿é—®æ— æƒè®¿é—®çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬å…¶é˜…è¯»ã€ç¼–è¾‘ã€ç§»åŠ¨ç­‰æ“ä½œï¼‰æ—¶ï¼Œä¼šè·³è½¬åˆ° `/error` é¡µé¢ã€‚<br />ç”¨æˆ·ç‚¹å‡»â€œè¿”å›â€å›åˆ° `/`ã€‚


# 2 ä»£ç ç®€è¿°

## 2.1 åŸºæœ¬é…ç½®

### 2.1.1 å·¥ç¨‹å»ºç«‹

1. åœ¨ [https://start.spring.io/](https://start.spring.io/) å»ºç«‹äº† SpringBoot å·¥ç¨‹ï¼š

![image.png](./assets/1640533025090-4238ba9f-a678-4f88-ba8f-ad6e150758ab.png)

2. ç”¨ IDEA æ‰“å¼€å·¥ç¨‹ï¼ŒåŠ è½½ä¾èµ–é¡¹ã€‚


### 2.1.2 æ•°æ®åº“

3. å®‰è£…é…ç½® MySQL
4. æ•°æ®åº“è®¾è®¡ï¼š

![image.png](./assets/1640533536692-e4f0a90c-1b65-43ce-b339-21dc62c0e120.png)

5. æ•°æ®åº“å»ºç«‹ï¼š
```sql
create database xianyuque;

use xianyuque;

create table users (
	ID   varchar(32),
  Name varchar(64),
  EnKey  char(64),
  primary key(ID)
);

create table file_info (
  ID        int,
  title     varchar(64),
  localName varchar(64),
  isFolder  boolean,
  isTopLev  boolean,
  lastEdit  datetime,
  cacheFor  int,
  insideOf  int,
  primary key(ID),
  foreign key(cacheFor) references file_info(ID)
  	on delete cascade
   	on update cascade,
  foreign key(insideOf) references file_info(ID)
  	on delete cascade
   	on update cascade
);

create table visible_to (
  userID        varchar(32),
  fileID        int,
  isFirstAuthor boolean,
  isWritable    boolean,
  primary key(userID, fileID),
  foreign key(userID) references users(ID)
  	on delete cascade
   	on update cascade,
  foreign key(fileID) references file_info(ID)
  	on delete cascade
   	on update cascade
);

create table revision_of (
  srcFileID   int,
  revFileID   int,
  primary key(revFileID),
  foreign key(srcFileID) references file_info(ID)
  	on delete cascade
   	on update cascade,
  foreign key(revFileID) references file_info(ID)
  	on delete cascade
   	on update cascade
);

create table editing_by (
  fileID  int,
  userID  varchar(32),
  primary key(fileID),
  foreign key(userID) references users(ID)
  	on delete cascade
   	on update cascade,
  foreign key(fileID) references file_info(ID)
  	on delete cascade
   	on update cascade
)
```

5. å‚è€ƒé…ç½®ï¼š

`application.properties` å…¨æ–‡
```properties
#application.properties
server.address=0.0.0.0
server.port=8080

spring.datasource.url=jdbc:mysql://localhost:3306/xianyuque?characterEncoding=utf8&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=721121
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
mybatis.mapper-locations=classpath:mapper/*.xml
```
`pom.xml` è¿½åŠ 
```xml
<dependency>
  <groupId>mysql</groupId>
  <artifactId>mysql-connector-java</artifactId>
  <scope>runtime</scope>
</dependency>
```


## 2.2 ä»£ç ç»“æ„ç®€è¿°
![image.png](./assets/1640867993031-e32f29c6-201c-482b-a3ba-f05739692875.png)
åœ¨æœ¬å·¥ç¨‹ä¸­ï¼š

- resources æ˜¯ä¸€äº›èµ„æºï¼›å…¶ä¸­ï¼š
   - static å­˜æ”¾å›¾æ ‡ä»¥åŠ Editor.md çš„éƒ¨åˆ†èµ„æº
   - templates æ˜¯ç½‘é¡µçš„ html æ–‡ä»¶
      - ![image.png](./assets/1640868070230-ecdd74e4-e082-4e2e-af79-99efcf514fe1.png)
- java ä¸­çš„ com.xuaninsr.xianyuque ä¸­æ˜¯ä¸»è¦çš„ Java ä»£ç ï¼›å…¶ä¸­ï¼š
   - ç±» `XianyuqueApplication` æ˜¯å·¥ç¨‹çš„å…¥å£
   - åŒ… `pojo` (Plain Ordinary Java Object) ä¸­åŒ…å«äº† `Article`, `FileInfo`, `User` è¿™ä¸‰ä¸ªç®€å•çš„ JavaBean
      - ![image.png](./assets/1640868262571-cfd86b86-4b8c-40ee-9c54-5df162ac7548.png)
   - åŒ… `mapper` å’Œ `service` æ“ä½œæ•°æ®åº“å–å¾—ä¸æ–‡ä»¶ã€ç”¨æˆ·æœ‰å…³çš„ä¸€äº›ä¿¡æ¯ï¼Œæ„æˆæˆ‘ä»¬çš„ mapper å’Œ service å±‚ï¼Œä¸º controller å±‚æä¾›æœåŠ¡
      - ![image.png](./assets/1640868354999-c95f045a-33c8-4a8f-b765-a3c8c4d2fddf.png)
   - åŒ… `controller` æ˜¯ controller å±‚ï¼Œç”¨äºå¤„ç† HTTP request
   - åŒ… `utils` åŒ…è£…äº†æˆ‘ä»¬åœ¨æ–‡ä»¶æ“ä½œä»¥åŠ MD5 åŠ å¯†æ—¶ç”¨åˆ°çš„ä¸€äº›å·¥å…·æ–¹æ³•
      - ![image.png](./assets/1640868417975-e734a7e4-b377-49f2-ac39-2119ce7132a5.png)

å…³äºä»£ç çš„å…·ä½“ç»†èŠ‚ï¼Œè¯·å‚è§æºä»£ç ã€‚


# 3 æ€»ç»“ä¸è®¨è®º
æœ¬å·¥ç¨‹åœ¨å®ç°äº†é€‰é¢˜çš„åŸºç¡€åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œè¿˜å®Œæˆäº†å¦‚ä¸‹ **äº®ç‚¹**ï¼š

   - ä½¿ç”¨ Cookies ä¿å­˜ç™»å½•çŠ¶æ€
   - åœ¨æ•°æ®åº“ä¸­ä½¿ç”¨ MD5 ä¿å­˜å¯†ç ï¼Œæä¾›ä¸€å®šçš„å®‰å…¨æ€§
   - æ”¯æŒMarkdown
   - è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œä¿è¯éšç§æ€§
   - è¯»å†™åˆ†ç¦»ï¼Œå®šæœŸå’Œé€€å‡ºæ—¶è‡ªåŠ¨ä¿å­˜åˆ°ç¼“å­˜

æœ¬å·¥ç¨‹åœ¨è®¾è®¡ä¹‹åˆè¿˜è€ƒè™‘å®ç° **å¤šäººç¼–è¾‘**ï¼ˆæ•°æ®åº“ä¸­çš„ `Editing`ï¼‰ã€**å†å²ç‰ˆæœ¬**ï¼ˆæ•°æ®åº“ä¸­çš„ `RevisionOf`ï¼‰ç­‰åŠŸèƒ½ï¼Œä½†ç”±äºè€ƒè¯•å‘¨æ—¶é—´ç´§å¼ ï¼Œæœ€ç»ˆæ²¡æœ‰èƒ½å¤Ÿå®Œå…¨å®ç°ã€‚å½“ç„¶ï¼Œäº§å“ä¼šç»è¿‡è¿­ä»£çš„è¿‡ç¨‹ï¼›åœ¨åç»­çš„ç‰ˆæœ¬ä¸­ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œè¿™äº›åŠŸèƒ½åœ¨å·²ç»å»ºç«‹äº†è¿™äº›æ•°æ®åº“çš„åŸºç¡€ä¸Šä¹Ÿèƒ½æ›´å¥½åœ°å®Œæˆã€‚

æœ¬å·¥ç¨‹åœ¨è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œå¯¹ UI åšäº†ä¸€å®šçš„è€ƒé‡ï¼Œä½†æœ€ç»ˆç”±äºæ—¶é—´æœ‰é™åªä¼˜åŒ–äº†éƒ¨åˆ†é¡µé¢çš„ UIã€‚è¿™ä¹Ÿæ˜¯å¯ä»¥è¿›ä¸€æ­¥æå‡çš„éƒ¨åˆ†ã€‚

æœ¬å·¥ç¨‹åœ¨è®¾è®¡è¿‡ç¨‹ä¸­ä½¿ç”¨äº† GitHub åšç‰ˆæœ¬ç®¡ç†ï¼Œç»è¿‡äº† 5 å¤©çš„å¼€å‘ã€‚<br />éå¸¸æ„Ÿè°¢é™†åŠ©æ•™æä¾›çš„ã€ŠSpringBoot å…¥é—¨ã€‹æŒ‡å—ï¼Œè¿™ä¸ªæŒ‡å—å¸®åŠ©æˆ‘è¾ƒä¸ºè½»æ¾åœ°å…¥é—¨è¿™ä¸ªæ¡†æ¶å¹¶è®¾è®¡å‡ºäº†è¿™ä¸ªå·¥ç¨‹ã€‚<br />è¿‡ç¨‹ä¸­é‡åˆ°äº†å„ç§å„æ ·çš„é—®é¢˜ï¼Œæˆ‘ä¹Ÿéƒ½é€šè¿‡æœç´¢å¼•æ“å°è¯•è§£å†³ï¼›å…¶ä¸­æ¯”è¾ƒæœ‰ä»·å€¼çš„å†…å®¹æˆ‘ä¹Ÿä»¥è¿æ¥é™„åœ¨äº†æ–‡æœ«çš„â€œå‚è€ƒèµ„æ–™â€éƒ¨åˆ†ã€‚
![image.png](./assets/1640869485945-06184d84-21d7-4938-adf3-4e8da5821fd8.png)

å®Œç»“æ’’èŠ±ï¼ğŸ‰ğŸ‰ğŸ‰


# 4 å‚è€ƒèµ„æ–™
é™¤äº†ä¹‹å‰æåˆ°çš„å‚è€ƒèµ„æ–™å¤–ï¼Œæœ¬å·¥ç¨‹è¿˜å‚è€ƒäº†ï¼š

### 4.1 Thymeleaf ç›¸å…³

- Thymeleaf POST [https://stackoverflow.com/questions/17669212/send-datas-from-html-to-controller-in-thymeleaf](https://stackoverflow.com/questions/17669212/send-datas-from-html-to-controller-in-thymeleaf)
- è¿”å› ModelAndView [https://blog.csdn.net/weixin_44075963/article/details/103625527](https://blog.csdn.net/weixin_44075963/article/details/103625527)
- Thymeleaf åŠ JS å¦‚ä½•å– CONTROLLER ä¸­è¿”å›çš„ MODEL é‡Œçš„å€¼
   - [https://www.freesion.com/article/1135452868/](https://www.freesion.com/article/1135452868/)
- Thymeleaf + Editor.md 
   - [https://juejin.cn/post/6899038096805855246](https://juejin.cn/post/6899038096805855246)
   - [https://blog.csdn.net/qq_26212181/article/details/103762957](https://blog.csdn.net/qq_26212181/article/details/103762957)

### 4.2 Cookies ç›¸å…³

- ç™»å½• [https://blog.csdn.net/qq_42595527/article/details/110495208](https://blog.csdn.net/qq_42595527/article/details/110495208)
- Cookies [https://blog.csdn.net/weixin_42061487/article/details/105935331](https://blog.csdn.net/weixin_42061487/article/details/105935331)
- ä¿å­˜ç™»å½•çŠ¶æ€ [https://blog.csdn.net/zeping891103/article/details/76032949/](https://blog.csdn.net/zeping891103/article/details/76032949/)

### 4.3 JS ç›¸å…³

- å®šæ—¶è‡ªåŠ¨ä¿å­˜ [https://stackoverflow.com/questions/63763061/regularly-send-post-request-when-user-changes-value-in-textarea](https://stackoverflow.com/questions/63763061/regularly-send-post-request-when-user-changes-value-in-textarea)
- å…³é—­ç½‘é¡µæ—¶è‡ªåŠ¨ä¿å­˜ [https://glados.rocks/console/shop](https://glados.rocks/console/shop)
- JS å®ç° POST [https://www.cnblogs.com/blog-cq/p/6038410.html](https://www.cnblogs.com/blog-cq/p/6038410.html)

### 4.4 HTML å’Œ CSS ç›¸å…³

- è¡¨æ ¼å®ç°ç‚¹å‡» [https://stackoverflow.com/questions/47519295/onclick-thymeleaf-dynamic-url-parameter](https://stackoverflow.com/questions/47519295/onclick-thymeleaf-dynamic-url-parameter)
- æç¤ºæ¡†ç¡®è®¤åˆ é™¤ [https://www.cnblogs.com/szy13037-5/articles/9778071.html](https://www.cnblogs.com/szy13037-5/articles/9778071.html)
- HTML span ä¸¤ç«¯å¯¹é½ [https://blog.csdn.net/lkp1603645756/article/details/105297560/](https://blog.csdn.net/lkp1603645756/article/details/105297560/)

### 4.5 SQL ç›¸å…³

- è¿”å›å€¼ä¸º NULL æ—¶è®¾ç½®é»˜è®¤å€¼ [https://blog.csdn.net/weixin_42300435/article/details/111893842](https://blog.csdn.net/weixin_42300435/article/details/111893842)
