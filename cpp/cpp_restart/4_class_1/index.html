
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://xuan-insr.github.io/cpp/cpp_restart/4_class_1/">
      
      
        <link rel="prev" href="../3_oop/">
      
      
        <link rel="next" href="../5_class_2/">
      
      
      <link rel="icon" href="../../../logo.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.22">
    
    
      
        <title>4 类 (I) - 定义、成员、构造、析构 - 咸鱼暄的代码空间</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.732c4fb1.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Serif SC";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/timeago.css">
    
      <link rel="stylesheet" href="../../../from_oi_wiki/css/extra.css?v=13">
    
      <link rel="stylesheet" href="../../../css/status.css">
    
      <link rel="stylesheet" href="../../../css/neoteroi-mkdocs.css">
    
      <link rel="stylesheet" href="../../../termynal.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-JT9BRCXKJJ"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-JT9BRCXKJJ",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-JT9BRCXKJJ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#4-类-i---定义成员构造析构" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="咸鱼暄的代码空间" class="md-header__button md-logo" aria-label="咸鱼暄的代码空间" data-md-component="logo">
      
  <img src="../../../logo.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            咸鱼暄的代码空间
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4 类 (I) - 定义、成员、构造、析构
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="orange" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/xuan-insr/xuan-insr.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    xuan-insr/咸鱼暄的代码空间
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
    
  
  🏡 主页

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  C++

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../git/" class="md-tabs__link">
          
  
    
  
  新的技术积累！

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/" class="md-tabs__link">
          
  
    
  
  核心知识

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%AE%89%E5%85%A8/" class="md-tabs__link">
          
  
    
  
  安全

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../other_courses/" class="md-tabs__link">
          
  
    
  
  其他课程

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%9D%82%E9%A1%B9/" class="md-tabs__link">
          
  
    
  
  杂项

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../magic_tools/" class="md-tabs__link">
          
  
    
  
  妙妙工具

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E7%94%9F%E6%B4%BB/" class="md-tabs__link">
          
  
    
  
  生活

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="咸鱼暄的代码空间" class="md-nav__button md-logo" aria-label="咸鱼暄的代码空间" data-md-component="logo">
      
  <img src="../../../logo.ico" alt="logo">

    </a>
    咸鱼暄的代码空间
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/xuan-insr/xuan-insr.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    xuan-insr/咸鱼暄的代码空间
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    🏡 主页
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            🏡 主页
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%BB%E9%A1%B5/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ❤️ 关于我
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../recent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    📆 最近更新
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    C++
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            C++
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    网课 slides 与随材
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            网课 slides 与随材
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://xuan-insr.github.io/slides/cpp/1_birth_and_oop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week1 C++ 的诞生与面向对象程序设计
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../review/week1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week1 内容回顾
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://xuan-insr.github.io/slides/cpp/2_class_I/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week2 类(I) 定义、成员、构造、析构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../review/week2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week2 思考题与复习题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://xuan-insr.github.io/slides/cpp/3_class_II/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week3 类 (II) 拷贝赋值、拷贝构造、SMFs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../review/week3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week3 思考题与复习题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://xuan-insr.github.io/slides/cpp/4_class_III/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week4 类 (III) 隐式类型转换、拷贝构造、SMFs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../review/week4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week4 思考题与复习题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://xuan-insr.github.io/slides/cpp/5_template_I/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week5 模板 (I) 基础知识与 STL 使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://xuan-insr.github.io/slides/cpp/6_stl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week6 模板 (II) 理解 STL - 迭代器与函数对象
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://xuan-insr.github.io/slides/cpp/7_rvalue_ref/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week7 值类型、右值引用与移动语义
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://xuan-insr.github.io/slides/cpp/8_smart_ptr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week8 智能指针基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://xuan-insr.github.io/slides/cpp/9_class_IV/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Week9 类 (IV) 继承
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    正文！
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            正文！
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_birth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 C++ 的诞生
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2_paradigm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 编程范式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3_oop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 面向对象程序设计
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    4 类 (I) - 定义、成员、构造、析构
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    4 类 (I) - 定义、成员、构造、析构
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#41-类的定义" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 类的定义
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-声明与定义" class="md-nav__link">
    <span class="md-ellipsis">
      ▲ 声明与定义
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-类的成员" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 类的成员
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 类的成员">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#this-指针" class="md-nav__link">
    <span class="md-ellipsis">
      this 指针
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-inline-函数" class="md-nav__link">
    <span class="md-ellipsis">
      ▲ inline 函数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-构造函数" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 构造函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 构造函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#动态内存分配" class="md-nav__link">
    <span class="md-ellipsis">
      动态内存分配
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-函数默认参数与函数重载" class="md-nav__link">
    <span class="md-ellipsis">
      ▲ 函数默认参数与函数重载
    </span>
  </a>
  
    <nav class="md-nav" aria-label="▲ 函数默认参数与函数重载">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#默认参数" class="md-nav__link">
    <span class="md-ellipsis">
      默认参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#函数重载" class="md-nav__link">
    <span class="md-ellipsis">
      函数重载
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-构造函数-cont" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 构造函数 (Cont.)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 构造函数 (Cont.)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implicitly-declared-default-constructor" class="md-nav__link">
    <span class="md-ellipsis">
      implicitly-declared default constructor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#member-initializer-lists" class="md-nav__link">
    <span class="md-ellipsis">
      member initializer lists
    </span>
  </a>
  
    <nav class="md-nav" aria-label="member initializer lists">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delegating-constructor" class="md-nav__link">
    <span class="md-ellipsis">
      delegating constructor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-member-initializer" class="md-nav__link">
    <span class="md-ellipsis">
      default member initializer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-析构函数" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 析构函数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#45-构造和析构的时机和顺序" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 构造和析构的时机和顺序
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#46-小结" class="md-nav__link">
    <span class="md-ellipsis">
      4.6 小结
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5_class_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 类 (II) - 拷贝赋值、运算符重载与引用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6_class_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 类 (III) - 拷贝构造、SMFs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7_template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 模板 (I) - 基本知识与 STL 使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../8_stl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 模板 (II) - 理解 STL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../9_move_semantics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9 右值引用和移动语义
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10_smart_ptr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 智能指针基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../11_class_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 类 (IV) - 继承、RTTI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12_exception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12 exception
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    A 附录
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            A 附录
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/decl_and_def/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    声明与定义
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/inline_functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    inline 函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/func_overload/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    函数默认参数与重载
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/operator_overload/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运算符重载
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    引用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/iostream/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I/O stream
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/copy_elision/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    copy elision
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/cast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型转换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/bool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bool
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/auto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/undefined_behavior/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    未定义行为
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/string/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    std::string
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/smart_pointers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    智能指针
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix/lambda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lambda
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    B 总结
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            B 总结
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../summaries/member_init_lists/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    member initializer lists
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    一些笔记和 TODO
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            一些笔记和 TODO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notes/notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    零散内容记录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notes/dne_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Design and Evaluation of C++ 阅读记录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notes/std_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ 语言标准阅读记录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notes/guideline_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ Core Guidelines 阅读记录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notes/bs_faq_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bjarne Stroustrup's FAQ 阅读记录
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cpp_for_contests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快速入门 C++ 写题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    C++ 知识补充
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            C++ 知识补充
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E7%90%86%E8%A7%A3%20STL%20-%20%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E5%87%BD%E6%95%B0%E5%AF%B9%E8%B1%A1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    理解 STL —— 迭代器与函数对象
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    新的技术积累！
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            新的技术积累！
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../git/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    通过造轮子学习 git！
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            通过造轮子学习 git！
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../git/notes/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    录播笔记
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_1_2" id="__nav_3_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2">
            <span class="md-nav__icon md-icon"></span>
            录播笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/notes/1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Post 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/notes/2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Post 2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/0_preface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    0 写在前面
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/1_framework/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 构建框架
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/2_init/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 初始化仓库
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/3_obj_storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 对象存储
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../git/4_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 暂存区
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../bash/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Bash
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Bash
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../python/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    咸鱼暄学 Python
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            咸鱼暄学 Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../python/coverage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用 Coverage.py 衡量 Python 测试覆盖率
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../gitlab/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    GitLab CI
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            GitLab CI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../gitlab/artifacts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用 GitLab CI Artifacts 在 Job 之间共享文件
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../bazel/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Bazel
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Bazel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bazel/build_system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    构建系统基础 | Why Bazel
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    核心知识
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            核心知识
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    操作系统
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            操作系统
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/I_overview/1_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 写在前面
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/I_overview/2_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part.1 概述
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_3" >
        
          
          <label class="md-nav__link" for="__nav_4_2_3" id="__nav_4_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part.2 进程管理
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_3">
            <span class="md-nav__icon md-icon"></span>
            Part.2 进程管理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/II_process_management/3_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 进程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/II_process_management/4_sched/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 调度
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/II_process_management/5_thread/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 线程
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_4" >
        
          
          <label class="md-nav__link" for="__nav_4_2_4" id="__nav_4_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part.3 进程同步
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_4">
            <span class="md-nav__icon md-icon"></span>
            Part.3 进程同步
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/III_process_sync/6_sync_tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 同步及其工具
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/III_process_sync/7_sync_examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7 经典同步问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/III_process_sync/8_deadlocks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 死锁
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_5" >
        
          
          <label class="md-nav__link" for="__nav_4_2_5" id="__nav_4_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part.4 内存管理
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_5">
            <span class="md-nav__icon md-icon"></span>
            Part.4 内存管理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/IV_memory_management/9_main_memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9 主存
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/IV_memory_management/10_virtual_memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 虚拟内存
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_6" >
        
          
          <label class="md-nav__link" for="__nav_4_2_6" id="__nav_4_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part.5 存储管理
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_6">
            <span class="md-nav__icon md-icon"></span>
            Part.5 存储管理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/V_storage_management/11_mass_storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 大容量存储
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/V_storage_management/12_io_systems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12 I/O 系统
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2_7" >
        
          
          <label class="md-nav__link" for="__nav_4_2_7" id="__nav_4_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part.6 文件系统
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2_7">
            <span class="md-nav__icon md-icon"></span>
            Part.6 文件系统
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/VI_file_system/13_fs_interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    13 文件系统
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/VI_file_system/14_fs_impl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14 文件系统实现
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/15_review/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    15 总结
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../computer_organization/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    计算机组成
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            计算机组成
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../computer_organization/1_prelude/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 Prelude
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../computer_organization/2_instructions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 Instructions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../computer_organization/3_arithmetic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 Arithmetic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../computer_organization/4_processor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 Processor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../computer_organization/5_cache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../computer_organization/6_IO/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 I/O
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../computer_organization/%E5%8E%86%E5%B9%B4%E5%8D%B7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022 回忆卷
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../compile_principle/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    编译原理
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            编译原理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../compile_principle/1%20Lexical%20Analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I 词法分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../compile_principle/2%20Parsing%20%28I%29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    II 语法分析 - 自顶向下分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../compile_principle/3%20Parsing%20%28II%29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    III 语法分析 - 自底向上分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../compile_principle/4%20Semantic%20Analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IV 语义分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../compile_principle/5%20Runtime%20Environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    V 运行时环境
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../compile_principle/6%20Code%20Generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    VI 代码生成
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../math_ds_algo/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    数学、数据结构和算法
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            数学、数据结构和算法
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../math_ds_algo/getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    入门路线
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../math_ds_algo/dp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态规划 | Dynamic Programming
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../%E5%AE%89%E5%85%A8/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    安全
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            安全
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.yuque.com/xianyuxuan/coding/crypto" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    密码学
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.yuque.com/xianyuxuan/coding/advcrypto" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    密码学进阶
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.yuque.com/xianyuxuan/coding/softwsec" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    软件安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.yuque.com/xianyuxuan/coding/netsec" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网络安全原理与实践
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.yuque.com/xianyuxuan/coding/syssec" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    系统安全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.yuque.com/xianyuxuan/coding/wireless_iot" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    无线与物联网安全基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.yuque.com/xianyuxuan/coding/signal_processing" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    面向信息安全的信号处理
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../other_courses/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    其他课程
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            其他课程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../other_courses/theory_of_computation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计算理论
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../pl/ppl_notes/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    编程语言原理
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            编程语言原理
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/0_PPL_Final_Problem1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    我在 PPL 2022 Final 出的复习题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3_3" id="__nav_6_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part I - Judgments and Rules | 判断与规则
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_3">
            <span class="md-nav__icon md-icon"></span>
            Part I - Judgments and Rules | 判断与规则
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/1_Abstract_Syntax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1 抽象语法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/2_Inductive_Definition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2 归纳定义
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/3_Hypothetical_and_General_Judgments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3 假言判断与一般性判断
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_4" >
        
          
          <label class="md-nav__link" for="__nav_6_3_4" id="__nav_6_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part II - Statics and Dynamics | 静态语义和动态语义
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_4">
            <span class="md-nav__icon md-icon"></span>
            Part II - Statics and Dynamics | 静态语义和动态语义
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/4_Statics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4 静态语义
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/5_Dynamics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5 动态语义
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/6_Type_Safety/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6 类型安全
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_5" >
        
          
          <label class="md-nav__link" for="__nav_6_3_5" id="__nav_6_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part III - Total Functions | 全函数
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_5">
            <span class="md-nav__icon md-icon"></span>
            Part III - Total Functions | 全函数
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/8_Func_Def_and_Val/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8 函数定义和值
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/9_Sys_T_of_Higher_Order_Recursion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9 高阶递归的系统 T
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3_6" >
        
          
          <label class="md-nav__link" for="__nav_6_3_6" id="__nav_6_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Part IV - Finite Data Types | 有限数据类型
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3_6">
            <span class="md-nav__icon md-icon"></span>
            Part IV - Finite Data Types | 有限数据类型
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/10_product_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10 积类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../pl/ppl_notes/11_sum_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11 和类型
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://www.yuque.com/xianyuxuan/coding/ocaml" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OCaml 入门
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../other_courses/big_physics_exp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    大物实验报告
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../%E6%9D%82%E9%A1%B9/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    杂项
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            杂项
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%9D%82%E9%A1%B9/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    博客搭建记录
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../magic_tools/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    妙妙工具
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            妙妙工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../magic_tools/personal_income_tax/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    个税计算器
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../%E7%94%9F%E6%B4%BB/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    生活
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            生活
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_2" >
        
          
          <label class="md-nav__link" for="__nav_9_2" id="__nav_9_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    讨饭历程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_2">
            <span class="md-nav__icon md-icon"></span>
            讨饭历程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../interviews/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🏳️‍🌈 总览
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../interviews/pdd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    😕 拼多多
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../interviews/meituan/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🤗 美团
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../interviews/mayi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🤔 蚂蚁
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../interviews/huawei/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    👍 华为
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../interviews/bytedance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    🥳 字节
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../interviews/quant/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    👨‍💻 量化相关
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../interviews/others/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    其他
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%9F%E6%B4%BB/%E5%92%B8%E9%B1%BC%E6%9A%84%E4%BB%8A%E5%A4%A9%E5%90%83%E4%BB%80%E4%B9%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    咸鱼暄今天吃什么
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%9F%E6%B4%BB/%E6%88%91%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA%E5%A4%96%E7%BD%AE%E5%A4%A7%E8%84%91/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    我需要一个外置大脑
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%9F%E6%B4%BB/%E4%BA%B2%E5%AF%86%E5%85%B3%E7%B3%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于亲密关系的碎碎念
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%9F%E6%B4%BB/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022 年终总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%9F%E6%B4%BB/%E5%9B%9E%E9%A1%BE%E5%9C%A8%E4%BF%A1%E5%AE%89%E7%9A%84%E4%B8%89%E5%B9%B4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    回顾在信安的三年
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%94%9F%E6%B4%BB/%E7%A7%9F%E6%88%BF%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    咸鱼暄的租房记录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../%E6%A1%8C%E6%B8%B8/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    桌游
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9_9" id="__nav_9_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9_9">
            <span class="md-nav__icon md-icon"></span>
            桌游
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%A1%8C%E6%B8%B8/components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    配件相关
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#41-类的定义" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 类的定义
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-声明与定义" class="md-nav__link">
    <span class="md-ellipsis">
      ▲ 声明与定义
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-类的成员" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 类的成员
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.2 类的成员">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#this-指针" class="md-nav__link">
    <span class="md-ellipsis">
      this 指针
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-inline-函数" class="md-nav__link">
    <span class="md-ellipsis">
      ▲ inline 函数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-构造函数" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 构造函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 构造函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#动态内存分配" class="md-nav__link">
    <span class="md-ellipsis">
      动态内存分配
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-函数默认参数与函数重载" class="md-nav__link">
    <span class="md-ellipsis">
      ▲ 函数默认参数与函数重载
    </span>
  </a>
  
    <nav class="md-nav" aria-label="▲ 函数默认参数与函数重载">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#默认参数" class="md-nav__link">
    <span class="md-ellipsis">
      默认参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#函数重载" class="md-nav__link">
    <span class="md-ellipsis">
      函数重载
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-构造函数-cont" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 构造函数 (Cont.)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.3 构造函数 (Cont.)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implicitly-declared-default-constructor" class="md-nav__link">
    <span class="md-ellipsis">
      implicitly-declared default constructor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#member-initializer-lists" class="md-nav__link">
    <span class="md-ellipsis">
      member initializer lists
    </span>
  </a>
  
    <nav class="md-nav" aria-label="member initializer lists">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delegating-constructor" class="md-nav__link">
    <span class="md-ellipsis">
      delegating constructor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-member-initializer" class="md-nav__link">
    <span class="md-ellipsis">
      default member initializer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-析构函数" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 析构函数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#45-构造和析构的时机和顺序" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 构造和析构的时机和顺序
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#46-小结" class="md-nav__link">
    <span class="md-ellipsis">
      4.6 小结
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="4-类-i---定义成员构造析构">4 类 (I) - 定义、成员、构造、析构<a class="headerlink" href="#4-类-i---定义成员构造析构" title="Permanent link">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8V2m6.78 1a.69.69 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38-2.5-2.5Z"/></svg></span> 约 4940 个字 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 252 行代码 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3L12.5 13Z"/></svg></span> 预计阅读时间 20 分钟</p>
</div>
<div class="admonition info">
<p class="admonition-title">本节录播地址</p>
<p>本节的朋辈辅学录播可以在 <a href="https://www.bilibili.com/video/BV1Q24y1x7vE">B 站</a> 找到！</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>从本节开始，我们在部分内容会尝试直接使用 standard 的相应内容讲解<sup id="fnref:std_version"><a class="footnote-ref" href="#fn:std_version">1</a></sup>。由于会涉及到一些尚未讨论的内容，因此这些内容我们会通过脚注的方式给出。初学者可以忽略这些脚注。</p>
<p>因此，从本节开始，类似本节这样有比较大量的参考资料标注和脚注的文章，会提供下面的按钮来帮助提高阅读质量（文末也会有一份）：</p>
<p><script>
function inFootnote(element) {
    let parent = element.parentNode;
    while (parent !== null) {
      if (parent.classList &amp;&amp; parent.classList.contains("footnote")) {
        break;
      }
      parent = parent.parentNode;
    }
    return parent !== null;
}
</script>
<script>
function toggleVisibility() {
  const links = document.querySelectorAll('a');
  const buttons = document.querySelectorAll('.xyx-toggle');
  links.forEach(link =&gt; {
    if (!link.classList.contains('md-nav__link') &amp;&amp;
        !link.classList.contains('md-tabs__link') &amp;&amp;
        !link.classList.contains('md-source') &amp;&amp;
        !link.classList.contains('md-header__button') &amp;&amp;
        !link.closest('.md-nav__link') &amp;&amp;
        !link.closest('.md-tabs__link') &amp;&amp;
        !link.closest('.md-source') &amp;&amp;
        !link.closest('.footnote-backref') &amp;&amp;
        !link.closest('.footnote-ref') &amp;&amp;
        !link.closest('.md-header__button') &amp;&amp;
        !inFootnote(link)
        ) {
      if (link.style.display === 'none') {
        link.style.display = 'inline';
        for (const button of buttons) {
            button.innerHTML = '点击此处隐藏正文所有链接';
        }
      } else {
        link.style.display = 'none';
        for (const button of buttons) {
            button.innerHTML = '点击此处显示正文所有链接';
        }
      }
    }
  });
}
</script>
<script>
function toggleVisibilityFoot() {
  const links = document.querySelectorAll('a');
  const buttons = document.querySelectorAll('.xyx-toggle2');
  links.forEach(link =&gt; {
    if (link.closest('.footnote-backref') ||
        link.closest('.footnote-ref')) {
      if (link.style.display === 'none') {
        link.style.display = 'inline';
        for (const button of buttons) {
            button.innerHTML = '点击此处隐藏本文所有脚注';
        }
      } else {
        link.style.display = 'none';
        for (const button of buttons) {
            button.innerHTML = '点击此处显示本文所有脚注';
        }
      }
    }
  });</p>
<p>const footnotes = document.querySelectorAll('.footnote');
  for (const footnote of footnotes) {
    if (footnote.style.display === 'none') {
      footnote.style.removeProperty('display');
    } else {
      footnote.style.display = 'none';
    }
  }
}
</script></p>
<p><center>
<button onclick="toggleVisibility()" class="box box-yellow xyx-toggle">点击此处隐藏正文所有链接</button>
<button onclick="toggleVisibilityFoot()" class="box box-green xyx-toggle2">点击此处隐藏本文所有脚注</button>
</center></p>
</div>
<div class="admonition warning">
<p class="admonition-title">本节使用的副本</p>
<p>自本节开始，我们会在讲解类相关的内容时，引入一些 C++ 语法说明。这些说明有的是阐明容易混淆的概念，有的是介绍 C++ 相对于 C 的新语法。这些章节用 ▲ 表示。它们仍然是文章的重要部分，但由于本身话题相对独立，因此单独在导航目录中的「A 附录」一节中展示；正文里的是插件引入的副本，因此本文的字数统计并不包含这些副本。</p>
<p>本节引入的副本包括：</p>
<ul>
<li><a href="../appendix/decl_and_def">声明与定义</a></li>
<li><a href="../appendix/inline_functions">inline 函数</a></li>
<li><a href="../appendix/func_overload">函数默认参数与函数重载</a></li>
</ul>
</div>
<h2 id="41-类的定义">4.1 类的定义<a class="headerlink" href="#41-类的定义" title="Permanent link">&para;</a></h2>
<p>我们在上一节已经看到了类的定义的一些具体例子，例如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Textbox</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Shape</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">text</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">penwidth</span><span class="p">;</span>

<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">do_draw</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">old_penwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_penwidth</span><span class="p">();</span>
<span class="w">        </span><span class="n">set_penwidth</span><span class="p">(</span><span class="n">penwidth</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// 画出文本框和文本内容</span>
<span class="w">        </span><span class="n">set_penwidth</span><span class="p">(</span><span class="n">old_penwidth</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>在 C++ 中，每个类的定义 (class definition) 引入一个新的类型<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.name#1">class.name#1</a></sup>。因此，有了上面的定义，我们就可以用它来声明一个变量，如 <code>Textbox tb;</code> 声明并定义<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/basic.def#2">basic.def#2</a></sup>了一个类型为 <code>Textbox</code>，名为 <code>tb</code> 的变量。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>在 C++ 中，用类来定义变量时，不必像 C 语言那样带有 <code>struct</code> 关键字。即，如果有 <code>class Foo</code> 或者 <code>struct Bar</code> 的定义，那么 <code>Foo x;</code>, <code>class Foo x;</code>, <code>Bar b;</code>, <code>struct Bar b;</code> 都是合法的声明语句。这是因为，从 C with Classes 设计之初就希望让用户定义的类型不是二等公民，而是能被与内置类型一样的方式使用。</p>
<details class="tips">
<summary>Elaborated type specifiers</summary>
<p>带有 <code>struct</code> 或者 <code>class</code> 关键字的类型名 (如 <code>class Foo</code>) 叫做 Elaborated type specifiers<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/dcl.type.elab">dcl.type.elab</a></sup>。</p>
<p>在 C 语言中，类似 <code>struct x {}; int x;</code> 是符合语法的：虽然这会使得名字 <code>x</code> 既表示一个结构体，又表示一个变量；但在 C 语言中这不会引起歧义，因为当 <code>x</code> 表示结构体时必须带上 <code>struct</code> 关键字。不过在 C++ 中，直接使用 <code>x</code> 就只能引用到变量 <code>x</code> 了，因为此时 <code>int x;</code> 的 <code>x</code> hides <code>struct x {};</code> 的 <code>x</code><sup><a href="https://timsong-cpp.github.io/cppwp/n4868/basic.scope.hiding">basic.scope.hiding</a></sup>。</p>
<p>但是为了兼容 C，C++ 并没有禁止上述写法，而是规定可以通过 Elaborated type specifiers 显式地来使用结构体 <code>x</code>，即使用 <code>struct x</code><sup><a href="https://timsong-cpp.github.io/cppwp/n4868/basic.lookup.elab#1">basic.lookup.elab#1</a>,<a href="https://timsong-cpp.github.io/cppwp/n4868/class.name#2">class.name#2</a></sup>；对 <code>class</code> 也一样。</p>
<p>Elaborated type specifiers 还在 forward declaration 以及 enum 中有用途。</p>
</details>
</div>
<p>具体来说，类的定义具有如下形式<sup id="fnref:class-specifier"><a class="footnote-ref" href="#fn:class-specifier">2</a></sup><sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.pre#1">class.pre#1,2</a></sup>：</p>
<p><center><img alt="" src="../2023-02-09-20-19-03.png" width="600" /></center></p>
<ol>
<li>这里的 opt 指明某个元素是可选的。例如，class-specifier: class-head { member-specification<sub>opt</sub> } 说明 class-specifier 中可以没有 member-specification，例如 <code>class Foo {}</code> 或者 <code>class A : public B {}</code> 之类的。</li>
<li>这里的 class-name 是一个 identifier<sup id="fnref:class-name"><a class="footnote-ref" href="#fn:class-name">3</a></sup>，例如上面的 <code>Foo</code> 和 <code>A</code>。</li>
<li>这里的 class-key 决定了类是否是一个 union，以及默认情况下成员是 public 的还是 private 的。union 一次最多保存一个数据成员的值。也就是说，在 C++ 中，struct, class, union 都是类。但是在本节的后续讨论中，我们暂时只讨论 struct 和 class。</li>
<li>这里的 attribute-specifier-seq 和 class-virt-specifier 现在暂时不用管。</li>
<li>这里的 base-clause 定义为 <code>base-clause : base-specifier-list</code>，是用来处理派生类的。例如 1 中的 <code>: public B</code>。</li>
<li>这里的 nested-name-specifier 是 <code>::</code> 或者 <code>Foo::</code> 之类的东西，其意义可以看下面的例子<sup id="fnref:refer_to_same"><a class="footnote-ref" href="#fn:refer_to_same">4</a></sup><sup id="fnref:nonzero_size"><a class="footnote-ref" href="#fn:nonzero_size">5</a></sup>：<br />
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">https://godbolt.org/z/shjxaKhxc</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Inner</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">};</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Outer</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">Inner</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">Outer</span><span class="o">::</span><span class="n">Inner</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="n">Inner</span><span class="w"> </span><span class="n">i2</span><span class="p">;</span>
<span class="w">    </span><span class="o">::</span><span class="n">Inner</span><span class="w"> </span><span class="n">i3</span><span class="p">;</span><span class="w">     </span><span class="c1">// global Inner</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">A</span><span class="p">;</span><span class="w">       </span><span class="c1">// declares struct Outer::A</span>
<span class="p">};</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">Outer</span><span class="o">::</span><span class="n">A</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// defines struct Outer::A</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Outer</span><span class="w"> </span><span class="n">o</span><span class="p">;</span>
<span class="w">    </span><span class="n">Inner</span><span class="w"> </span><span class="n">i4</span><span class="p">;</span>
<span class="w">    </span><span class="n">Outer</span><span class="o">::</span><span class="n">Inner</span><span class="w"> </span><span class="n">i5</span><span class="p">;</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d %d %d %d %d&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">i2</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">i3</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">i4</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="w"> </span><span class="n">i5</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// Possible output: 4 4 1 1 4</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
在 C++ 中，类的定义会引入新的作用域，其范围是 member-specification 等<sup><a href="https://timsong-cpp.github.io/cppwp/basic.scope.class#1">basic.scope.class#1</a></sup><sup id="fnref:class-scope"><a class="footnote-ref" href="#fn:class-scope">10</a></sup>。因此这里的 <code>Outer::Inner</code> 和外面的 <code>Inner</code> 可以同时存在<sup id="fnref:redeclaration"><a class="footnote-ref" href="#fn:redeclaration">9</a></sup>。<br />
这里第 7 行访问到 <code>Outer::Inner</code> 是因为 Name Hiding<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/basic.scope.hiding">basic.scope.hiding</a></sup>，即我们熟悉的作用域屏蔽<sup id="fnref:name_hiding"><a class="footnote-ref" href="#fn:name_hiding">11</a></sup>。</li>
</ol>
<p>C 和 C++ 都是按名等价 (name equivalence) 而非按结构等价 (structural equivalence) 的<sup id="fnref:structural"><a class="footnote-ref" href="#fn:structural">6</a></sup>，例如<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.name#1">class.name#1</a></sup>：</p>
<p><center><img alt="" src="../2023-02-09-22-36-23.png" width="600" /></center></p>
<details class="tips">
<summary>Forward Declaration</summary>
<p>如果当前作用域没有名为 <code>identifier</code> 的类，那么形如 <code>class-key attr identifier ;</code> 的声明是一个 forward declaration<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.name#2">class.name#2</a></sup>。</p>
<p>例如 <code>class Foo;</code>，它声明了一个叫 <code>Foo</code> 的类；但直到这个类被定义之前，它的类型是不完整的<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/basic.types.general#5">basic.types.general#5</a></sup>。</p>
<p>不完整的类型有一些限制，但是也有一些可以完成的操作。例如不完整的类型不能用来定义变量（包括成员变量）、作为函数声明或定义的参数或者返回值类型等；但是可以定义指向它的指针。</p>
<p>例如，常见的用途是，两个类可能会互相使用。这时就可以写出类似下面这样的代码：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">X</span><span class="p">;</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Y</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">X</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// X mem; // Error: field has incomplete type &#39;X&#39;</span>
<span class="w">    </span><span class="n">X</span><span class="o">*</span><span class="w"> </span><span class="nf">foo</span><span class="p">();</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">X</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Y</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
<span class="w">    </span><span class="n">Y</span><span class="o">*</span><span class="w"> </span><span class="nf">bar</span><span class="p">();</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>这时第 1 行是必须的，否则第 3 行的 <code>X</code> 就是一个未知的类型。</p>
</details>
<details class="tips">
<summary>Injected Class Name</summary>
<p>C++ 规定，A class-name is inserted into the scope in which it is declared immediately after the class-name is seen. The class-name is also inserted into the scope of the class itself; this is known as the injected-class-name<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.pre#2">class.pre#2</a></sup>。这就是 <code>struct Node { Node* next; };</code> 能够使用 <code>Node</code> 的原因。</p>
<p>但是，考虑内存布局容易理解，class <code>C</code> 内部不能有 non-static data member of type <code>C</code>。</p>
</details>
<h2 id="-声明与定义">▲ 声明与定义<a class="headerlink" href="#-声明与定义" title="Permanent link">&para;</a></h2>
<p>声明将名字引入或重新引入到程序中。定义是声明的一种，指的是那些引入的名字对应的实体足以被使用的声明。</p>
<details class="info">
<summary>standard</summary>
<p>[<a href="https://timsong-cpp.github.io/cppwp/basic.pre#5">basic.pre#5</a>]: Every name is introduced by a declaration</p>
<p>[<a href="https://timsong-cpp.github.io/cppwp/n4868/basic.def#2">basic.def#2</a>]: Each entity declared by a declaration is also <em>defined</em> by that declaration unless:</p>
<ul>
<li>it declares a function without specifying the function's body</li>
<li>it contains the extern specifier or a linkage-specification (<code>extern "C" {}</code>) and neither an initializer nor a function-body,</li>
<li>it declares a non-inline static data member in a class definition</li>
<li>...</li>
</ul>
</details>
<p>声明「重新引入」的例子是：</p>
<div class="highlight"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
</code></pre></div>
<p>上面的例子是合法的。它们只是 <code>i</code> 和 <code>f</code> 的声明而非定义。</p>
<p>而下面的语句都是定义：</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">                          </span><span class="c1">// defines a</span>
<span class="k">extern</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">         </span><span class="c1">// defines c</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">    </span><span class="c1">// defines f and defines x</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">S</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="p">};</span><span class="w">     </span><span class="c1">// defines S, S​::​a, and S​::​b</span>
<span class="k">enum</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">up</span><span class="p">,</span><span class="w"> </span><span class="n">down</span><span class="w"> </span><span class="p">};</span><span class="w">              </span><span class="c1">// defines up and down</span>
<span class="n">S</span><span class="w"> </span><span class="n">anS</span><span class="p">;</span><span class="w">                          </span><span class="c1">// defines anS</span>
</code></pre></div>
<details class="note">
<summary>例外</summary>
<p>不过，也有一些不合法的情况，例如：</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</code></pre></div>
<p>这个例子会报 "redefinition of 'int i'" 错误。</p>
<p>根据上面的讨论，这两个语句都属于定义。[<a href="https://timsong-cpp.github.io/cppwp/basic.scope.scope#5">basic.scope.scope#5</a>] 规定 "The program is ill-formed if, in any scope, a name is bound to two declarations that potentially conflict and one precedes the other"。因此如果这两个 <code>i</code> 代表不同的 entity，则违反了这条规定；如果代表同一个 entity，则违反了 One-Definition Rule (ODR) [<a href="https://timsong-cpp.github.io/cppwp/n4868/basic.def.odr#1">basic.def.odr#1</a>] "No translation unit shall contain more than one definition of any variable, function, class type..."。</p>
<p>因此，下面的例子也是不合法的：</p>
<div class="highlight"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</code></pre></div>
<p>因为这两个语句也都属于定义。</p>
<p>另外：</p>
<div class="highlight"><pre><span></span><code><span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="k">extern</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</code></pre></div>
<p>这个例子会报 "redeclaration of 'i' with a different type" 错误<sup><a href="../std_citation_needed">std_citation_needed</a></sup>。</p>
</details>
<h2 id="42-类的成员">4.2 类的成员<a class="headerlink" href="#42-类的成员" title="Permanent link">&para;</a></h2>
<p>member-specification 说明了类的成员。其结构如下<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.mem.general">class.mem.general</a></sup>：</p>
<p><center><img alt="" src="../2023-02-11-15-49-10.png" width="400" /></center></p>
<p>其中 member-declaration 是成员的声明，而 access-specifier 是 <code>private</code>, <code>public</code>, <code>protected</code> 之一（前面两个我们讨论过了，第三个我们会在后文讨论）。成员可以包括成员变量、成员函数，也可以（嵌套的）类、枚举等，如本文前面代码中的 <code>Outer::Inner</code>，还可以包括声明类型的别名（如 <code>typedef</code> 和 <code>using</code>）等<sup id="fnref:class_member"><a class="footnote-ref" href="#fn:class_member">12</a></sup>。</p>
<div class="admonition note">
<p class="admonition-title">Type alias</p>
<p>C++11 引入了 <code>using</code> 来声明类型别名，它的用途和 <code>typedef</code> 类似，如 <code>typedef struct arraylist_* arraylist;</code> 可以写成 <code>using arraylist = struct arraylist_ *;</code>。</p>
<p>类型别名的声明也可以是类的成员，其作用域是类的作用域，同样受 access-specifier 的影响。例如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">elem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">;</span>
<span class="w">    </span><span class="n">elem</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">     </span><span class="c1">// OK, x has type int</span>
<span class="w">    </span><span class="n">elem</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">elem</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">char</span><span class="p">;</span>
<span class="w">    </span><span class="n">type</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w">     </span><span class="c1">// OK, c has type char</span>
<span class="p">};</span>

<span class="c1">// elem y;      // Error: unknown type name &#39;elem&#39;</span>
<span class="n">Foo</span><span class="o">::</span><span class="n">elem</span><span class="w"> </span><span class="n">z</span><span class="p">;</span><span class="w">    </span><span class="c1">// OK, z has type int</span>
<span class="c1">// Foo::type c; // Error: &#39;type&#39; is a private member of &#39;Foo&#39;   </span>
</code></pre></div></td></tr></table></div>
<p><code>using</code> 被引入是为了支持模板。我们在讲到模板的时候再来讨论这些问题。</p>
</div>
<p>类的成员函数可以在类内直接给出定义，也可以在类内只声明，在类外给出定义；这不影响成员函数的 access-specifier：</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<span class="p">};</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">Foo::bar</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f</span><span class="p">;</span>
<span class="w">    </span><span class="n">f</span><span class="p">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// Error: &#39;bar&#39; is a private member of &#39;Foo&#39;</span>
<span class="p">}</span>
</code></pre></div>
<p>另外，和全局函数一样，类的成员函数也可以只有声明没有定义，只要这个函数没有被使用：</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">();</span><span class="w">   </span><span class="c1">// OK if f() is never called;</span>
<span class="w">            </span><span class="c1">// if called, link error may occur</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">bar</span><span class="p">();</span><span class="w">     </span><span class="c1">// ditto</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="this-指针"><code>this</code> 指针<a class="headerlink" href="#this-指针" title="Permanent link">&para;</a></h3>
<p>我们之前介绍过，C++ 早期会被编译成 C 语言，然后再编译成汇编。那么问题来了！例如上面代码中的 <code>Foo::bar</code> 函数，如何编译成 C 中的函数呢？这一问题的难点是：这个函数里访问了调用这个函数的对象 (不妨称之为 calling object) 的成员变量 <code>x</code>；那么这个函数如何知道 calling object 在哪里，从而访问它的成员变量呢？</p>
<p>答案是，每个成员函数<sup id="fnref:this"><a class="footnote-ref" href="#fn:this">13</a></sup>都会被视为有一个 implicit object parameter，它即是 calling object。而在成员函数的函数体中，<code>this</code> 表达式的值即是 implicit object parameter 即 calling object 的地址。</p>
<p>在成员函数的函数体中，访问任何成员时都会被自动添加 <code>this-&gt;</code>，例如 <code>void Foo::bar(int v) { x += v; }</code> 中的 <code>x += v;</code> 实际是 <code>this-&gt;x += v;</code>。</p>
<p>下图中，汇编第 17~19 行将参数 <code>ff</code> 放到了第一个参数的位置，20 行调用 <code>f()</code>，事实上就是将这个对象的地址隐式传入其中了。</p>
<p><center><img alt="" src="../2023-03-04-02-13-48.png" width="300" /></center></p>
<p>自 C++23 开始，<code>this</code> 关键字有了新的含义。我们将在后面的章节讨论。</p>
<details class="note">
<summary>成员函数不能重新声明</summary>
<p>如果写了这样的代码：</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">();</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>gcc 12.2 会给出这样的报错：<code>'void Foo::foo()' cannot be overloaded with 'void Foo::foo()'</code></p>
<p>这会让人比较疑惑，因为这两个明明都只是声明。错误的原因其实是，标准规定，类的成员函数不应被重新声明，除非这个重新声明是出现在类定义之外的成员函数定义<sup id="fnref:redecl"><a class="footnote-ref" href="#fn:redecl">14</a></sup><sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.mfct#2">class.mfct#2</a></sup>。</p>
<p>clang 16.0.0 给出的报错就合理许多：<code>error: class member cannot be redeclared</code></p>
</details>
<h2 id="-inline-函数">▲ inline 函数<a class="headerlink" href="#-inline-函数" title="Permanent link">&para;</a></h2>
<p>我们在 OOP 一节中，讨论封装时介绍了 getters 和 setters：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">User</span><span class="w"> </span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">checkPassword</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">pw</span><span class="p">);</span><span class="w"> </span><span class="c1">// check if pw == password</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">setAge</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="nf">getAge</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">age</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>但是，众所周知，函数调用是有开销的，函数开销主要用来传递参数和获取返回值，需要时还要保存寄存器的值。看下面的例子：</p>
<p><center><img alt="" src="../2023-02-23-00-42-13.png" width="300" /></center></p>
<p>可以看到，虽然 <code>int foo(int x) { return add5(x); }</code> 和 <code>int foo(int x) { return x + 5; }</code> 是等效的；但是由于函数调用的存在，其效率是慢的。那么，<code>getAge()</code> 作为一个函数，是否也有这种代价呢？</p>
<p>C++ 的设计哲学决定了：不应当因为封装性而带来额外的性能开销。如果 getters 和 setters 的调用也需要额外开销的话，追求效率的程序员就会选择不使用封装。因此这个问题如何解决呢？早在 C with Classes 设计之初，这个问题就通过 <strong>内联替换 (inline substitution)</strong><sup><a href="https://timsong-cpp.github.io/cppwp/n4868/dcl.inline#2">dcl.inline#2</a></sup> 被解决了。</p>
<p>内联替换有点类似于 function-like macros<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/cpp.replace.general#2">cpp.replace.general#2</a></sup>，即在函数调用的地方将函数体展开，而不经过函数调用的步骤。作为一个例子，在选择 <code>-O1</code> 优化的情况下，上面的代码会变成这样：</p>
<p><center><img alt="" src="../2023-02-23-01-03-43.png" width="300" /></center></p>
<p>可以明显看到，<code>foo()</code> 的计算过程中不再有函数调用出现了。</p>
<p>再举一个例子，如果有这样的代码：</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">swap</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>如果 <code>swap</code> 函数被内联，那么程序可能会等价于：</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>有了内联替换，getter 和 setter 就不再有额外的开销了：</p>
<p><center><img alt="" src="../2023-02-23-02-06-15.png" width="300" /></center></p>
<div class="admonition note inline end">
<p class="admonition-title">Note</p>
<p>内联函数是 C++ 和 C 共同发展的一个例子。在 C89 中并没有内联函数，而 C99 和 C++ 中都有内联函数。</p>
<p>C++17 开始，<code>inline</code> 还被用于变量。我们会在（也许）不远的将来讨论这个话题。</p>
</div>
<p>那么，什么样的函数会被内联呢？在 C with Classes 中，只有那些函数体写在类的定义中的成员函数才会被内联。当然，并非所有这样的函数都会被内联，比如如果某个函数是递归的，那么这个函数很可能就没办法被内联。（当然，如果编译器想的话，可以通过递归展开实现内联。）</p>
<p>而在后来的 C++ 中，<code>inline</code> 关键字被引入；它用在函数声明中，例如 <code>inline int foo(int x) { return add5(x); }</code>。它向编译器表明一个建议：这里应该优先考虑使用内联替换而非通常的函数调用。函数体写在类的定义中的成员函数也会默认有此建议。（但是编译器通常忽略这种建议，而自己选择是否需要内联。例如前面图中 <code>add5</code> 那个函数，虽然我们没有写 <code>inline</code>，但是编译器仍然决定将它内联。）</p>
<p>显然，内联也是有代价的。如上面的例子所示，内联会在 <strong>每处</strong> 调用被展开，因此如果被内联的函数非常大，则会导致生成的目标代码很大，这会带来内存紧张或者局部性问题；这也可能会对性能产生一定影响。</p>
<p>内联函数是 C 语言中 function-like macros 的一个好的替换。<abbr title="Bjarne Stroustrup">BS</abbr> 说，C++ 希望「允许用语言本身表达所有重要的东西，而不是在注释里或者通过宏这类黑客手段」。宏是预处理器负责的事情，而非编译器。因此 function-like macros 的重大问题之一是缺乏类型检查，另外会因为括号之类的问题引发困扰。用内联的函数替代 function-like macros 也能够有作用域和访问控制，而这些如果使用宏则需要手动控制甚至没办法实现。</p>
<details class="info">
<summary>Info</summary>
<p>内联函数还有相关的很多问题。例如，假如在整个程序中的不同编译单元里，同一个内联函数有不同定义会发生什么事。由于 C++ 允许分别编译，这样的检查是极端困难的。因此，标准规定这种情况是 undefined behavior<sup><a href="../std_citation_needed">std_citation_needed</a></sup>。我们会在未来聊 undefined behavior 相关的问题。</p>
<p><a href="https://stackoverflow.com/a/1759575/14430730">这个回答</a> 指出：Don't add <code>inline</code> just because you think your code will run faster if the compiler inlines it. ... Generally, the compiler will be able to do this better than you.</p>
<p>因此，实际上在现在的 C++ 中，<code>inline</code> 比「让一个函数被内联」更重要的作用在于，帮助实现 header-only 的库。</p>
</details>
<h2 id="43-构造函数">4.3 构造函数<a class="headerlink" href="#43-构造函数" title="Permanent link">&para;</a></h2>
<p>构造函数 (constructor) 是一种特殊的成员函数，用于初始化该类的对象。构造函数 constructor 也时常被简写为 ctor 或者 c'tor 等。</p>
<p>用 <abbr title="Bjarne Stroustrup">BS</abbr> 的话说，构造函数的意义之一是「使程序员能够建立起某种保证，其他成员函数都能依赖这个保证」。例如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Container</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">elem</span><span class="o">*</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Container</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>在上面的程序中，第 5 行的 <code>Container()</code> 是构造函数。它和其他成员函数的区别是，它不写返回值类型，而且它直接使用类的名字。（构造函数并没有名字<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.ctor.general#2">class.ctor.general#2</a></sup>。）</p>
<p>第 6 行的 <code>val = nullptr;</code> 就是前面提到的「保证」，即 <code>val</code> 的值要么是 <code>nullptr</code>，要么是其他成员函数赋的值，而不会是个随机的值。</p>
<div class="admonition note">
<p class="admonition-title">nullptr</p>
<p><code>nullptr</code> 是 C++11 引入的一个关键字，用来表示空指针。这与 C 中的 <code>NULL</code> 不同，虽然后者在 C++ 中也能使用。我们在稍后介绍 <code>nullptr</code> 为什么会被引入。</p>
</div>
<p>这样，就可以使用 <code>Container c = Container();</code> 构造一个对象了<sup id="fnref:copy_ctor"><a class="footnote-ref" href="#fn:copy_ctor">15</a></sup>。</p>
<p><code>Container();</code> 会返回一个构造出的无名对象。不严谨地说，上面的语句将名字 <code>c</code> 绑定到了对应的无名对象上。为了代码更加简洁紧凑，C++ 允许更加简洁的写法：<code>Container c;</code>。</p>
<p>因此，当我们在用 <code>Container c;</code> 定义一个对象时，就会调用构造函数。例如：</p>
<p><center><img alt="" src="../2023-02-24-00-02-54.png" width="700" /></center></p>
<p>也就是说，由于定义一个对象时需要用到构造函数，因此如果要用的构造函数是 <code>private</code> 的，对象就无法被构造：</p>
<p><center><img alt="" src="../2023-03-04-01-35-48.png" /></center></p>
<details class="note" open="open">
<summary>Foo() 是调用构造函数的函数调用表达式吗？</summary>
<p>不是！看下面的代码：</p>
<div class="highlight"><pre><span></span><code><span class="n">Foo</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo</span><span class="p">();</span>
<span class="n">Foo</span><span class="w"> </span><span class="n">f2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foo</span><span class="o">::</span><span class="n">Foo</span><span class="p">();</span>
</code></pre></div>
<p>第二行会有报错：</p>
<p><center><img alt="" src="../2023-03-03-12-30-33.png" /></center></p>
<p>即，我们不能直接调用构造函数，这是因为 <strong>构造函数并没有名字，因此永远无法被用名字找到</strong><sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.ctor.general#2">class.ctor.general#2</a></sup>。<code>Foo();</code> 的写法并不是对构造函数的调用，而是一个 "function-style cast"。</p>
<p>这是什么东西呢？我们知道 C 语言中的类型转换 (cast) 表达式形如 <code>(int)3.2</code>（称为 C-style cast），而 C++ 引入了形如 <code>int(3.2)</code> 的 function-style cast。<code>int(3.2)</code> 将 3.2 显式地转换为了一个临时的 <code>int</code> 对象；类似地，<code>Foo()</code> 也（什么都不用地）显式地转换出了一个临时的 <code>Foo</code> 对象。虽然这个转换本身会使用到构造函数，但是这个表达式本身不是在调用构造函数。</p>
<p>这个东西的重要用途之一也是模板。我们会在后面的章节中再次讨论。</p>
</details>
<p>像普通的函数一样，构造函数可以是有参数的。例如，下面的构造函数允许用户传递一个初始大小，然后直接开一个对应大小的空间：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Container</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">elem</span><span class="o">*</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Container</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">elem</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>这样，就可以使用 <code>Container c2 = Container(64);</code> 构造一个自定义大小的容器了。</p>
<p>同样地，C++ 允许更加简洁的写法：<code>Container c2(64);</code>。即，如果无参地构造，则不需要写出括号；如果有参构造，则将参数写在括号中。</p>
<p>也就是说，在 C++ 中，声明变量时的 <strong>初始化器 (initializer)</strong> 除了类似 <code>int a = 4;</code> 的 <code>= initializer-clause</code> 之外，还有类似 <code>int a(4);</code> 的 <code>( expression-list )</code><sup><a href="https://timsong-cpp.github.io/cppwp/n4868/dcl.init.general#1">dcl.init.general#1</a></sup>。<sup id="fnref:initializer"><a class="footnote-ref" href="#fn:initializer">16</a></sup><sup id="fnref:equal-initializer"><a class="footnote-ref" href="#fn:equal-initializer">17</a></sup></p>
<details class="notes" open="open">
<summary>无参构造时为什么不用括号呢？</summary>
<p>这个问题被称为 <strong>most vexing parse</strong>。如果它加了括号，变成了 <code>Container c1();</code>，会被理解成什么呢？</p>
<p>我们来看这个东西：<code>int func();</code>，这显然是一个函数声明；而 <code>Container c1();</code> 的语法结构与其完全相同，因此这样的表述是有歧义的。</p>
<p>因此，C++ 规定无参构造时不用带括号（准确地说，声明语句中要么没有 initializer，如果有 initalizer 且是括号的形式的话则括号里不能为空<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/dcl.init.general#1">dcl.init.general#1</a></sup>）。</p>
<p>C++11 引入的 <strong>brace initialization</strong>（也被称为 <strong>uniform initialization</strong>）一定程度上解决了这个问题。我们在后面的章节讨论这个机制。</p>
</details>
<h3 id="动态内存分配">动态内存分配<a class="headerlink" href="#动态内存分配" title="Permanent link">&para;</a></h3>
<p>我们之前提到，构造函数存在的意义是给该类的每个对象提供一定的「保证」，而 C++ 通过确保每个对象都执行过构造函数来提供这一保证。但是，我们在 C 中知道通过 <code>malloc</code> 动态分配内存的方式；那么如果我们写 <code>Container *p = (Container *)malloc(sizeof(Container));</code> 会发生什么呢？</p>
<p>事实上，这确实分配了 <code>sizeof(Container)</code> 那么大的空间，但是确实也没有调用构造函数。因此，C++ 引入了新的用于创建动态对象的操作符 <code>new</code> 以及对应的用来回收的 <code>delete</code>。</p>
<p><code>new</code> 表达式可以用来创建对象或者数组：<code>int * p1 = new int; int * pa = new int[n];</code>。</p>
<p>如果是类的对象，则构造函数会被调用：</p>
<p><center><img alt="" src="../2023-03-05-16-37-46.png" /></center></p>
<p><code>new</code> 表达式也可以包含初始化器，但是只能是 <code>( something )</code> 或者 <code>{ something }</code> 的形式，不能是 <code>= something</code> 的形式：</p>
<p><center><img alt="" src="../2023-03-05-16-41-09.png" /></center></p>
<p><code>new</code> 表达式干的事情是申请内存 + 调用构造函数，返回一个指针；而 <code>delete</code> 表达式干的事情是调用析构函数 + 释放内存。<code>new</code> 表达式是 <strong>唯一</strong> 的用来创建动态生命周期对象的方式（因为 <code>malloc</code> 只是开辟内存，并不创建对象。对象是「a region of storage with <strong>associated semantics</strong>」）。</p>
<p><code>delete</code> 会调用类对象的析构函数：</p>
<p><center><img alt="" src="../2023-03-05-16-43-29.png" /></center></p>
<p>如上面例子所示，如果 <code>p</code> 在 <code>new</code> 的时候创建的是单个对象，则应该用 <code>delete p;</code> 的形式 (single-object delete expression) 回收；如果 <code>p</code> 在 <code>new</code> 的时候创建的是数组，则应该用 <code>delete[] p;</code> (array delete expression) 的形式回收，否则是未定义行为 (UB, undefined behavior)<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/expr.delete#2">expr.delete#2</a></sup>；这种情况下任何情况都有可能发生，包括但不限于（不需要诊断信息的）编译错误、运行时错误，或产生意料之外的运行结果等。我们会在后面的章节中具体讨论未定义行为。</p>
<p>关于 <code>new</code> 和 <code>delete</code>，我们还有一些话题没有讨论，例如 <code>operator new</code> 等以及 placement new。我们会在后面的章节中讨论相关问题。</p>
<h2 id="-函数默认参数与函数重载">▲ 函数默认参数与函数重载<a class="headerlink" href="#-函数默认参数与函数重载" title="Permanent link">&para;</a></h2>
<h3 id="默认参数">默认参数<a class="headerlink" href="#默认参数" title="Permanent link">&para;</a></h3>
<p>这样的构造函数允许用户传递一个初始大小，然后直接开一个对应大小的空间：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Container</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">elem</span><span class="o">*</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Container</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">elem</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>那么，假如我们希望用户既可以给定大小，也能够在不知道要开多大的情况下使用一个默认大小，怎么办呢？C++ 在函数声明中支持 <strong>默认参数 (default arguments)</strong>，用来允许函数可以以省略末尾的若干参数的方式调用：</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">point</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>

<span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// calls point(1, 2)</span>
<span class="n">point</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">    </span><span class="c1">// calls point(1, 4)</span>
<span class="n">point</span><span class="p">();</span><span class="w">     </span><span class="c1">// calls point(3, 4)</span>
</code></pre></div>
<p>默认参数必须出现在末尾的若干个参数中。这个要求的合理性容易理解：假如没有这个要求，那么如果有 <code>void point(int x = 3, int y);</code>，则 <code>point(4);</code> 的含义是容易让人迷惑的。</p>
<p>因此，<code>Container</code> 类的构造函数可以写成：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Container</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">elem</span><span class="o">*</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="k">public</span><span class="o">:</span>
<span class="hll"><span class="w">    </span><span class="n">Container</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">512</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">elem</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>这样，就可以使用 <code>Container c1;</code> 构造一个默认大小 (512) 的容器，或者用 <code>Container c2(64);</code> 构造一个自定义大小的容器了。前者实际上是 <code>Container(512)</code>，而后者是 <code>Container(64)</code>。</p>
<details class="info">
<summary>补充</summary>
<p>对于非模板函数，如果已声明的函数在 <strong>同一作用域</strong> 中重新声明（在内部作用域内的重新声明会出发作用域屏蔽），则可以向该函数添加默认参数。在函数调用时，默认值是该函数所有可见声明中提供的默认值的并集。对于默认值已经可见的参数，重新声明不能引入默认值（即使值相同）。</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">);</span><span class="w">     </span><span class="c1">// #1 </span>
<span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">);</span><span class="w"> </span><span class="c1">// #2 OK: adds a default</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">h</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// #1 and #2 are in scope; makes a call to f(3,7)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">);</span><span class="w"> </span><span class="c1">// Error: inner scope declarations don&#39;t acquire defaults</span>
<span class="p">}</span>
</code></pre></div>
<p>带默认参数的友元函数声明必须是一个定义，且 translation unit 中不能有其他声明。</p>
<p>默认参数不允许使用局部变量，除非它们 not evaluated（比如 <code>sizeof n</code>，参见 std notes 6.3）。</p>
<p>除了函数调用运算符 <code>operator()</code> 之外的运算符重载不能有默认参数。</p>
</details>
<h3 id="函数重载">函数重载<a class="headerlink" href="#函数重载" title="Permanent link">&para;</a></h3>
<p>那么，假如我希望根据是否传入某个参数来选择不同的构造函数，怎么办呢？例如我们希望 <code>Container</code> 的构造函数长这样：</p>
<div class="highlight"><pre><span></span><code><span class="n">Container</span><span class="o">::</span><span class="n">Container</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">elem</span><span class="w"> </span><span class="n">initVal</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">elem</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">);</span><span class="w">   </span><span class="c1">// allocate memory</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">       </span><span class="c1">// set init values</span>
<span class="w">        </span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initVal</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>但是！我们希望如果没有传入 <code>initVal</code>，就不要做那个 set init values 的循环怎么办呢？固然我们可以通过默认参数结合判断来实现，但是假如我们可以根据不同的传入参数来使用不同的构造函数就更好了！</p>
<p>事实上，C++ 支持这样的操作，这被称为 <strong>函数重载 (function overloading)</strong>：</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Container</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">elem</span><span class="o">*</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Container</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="n">Container</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">elem</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Container</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">elem</span><span class="w"> </span><span class="n">initVal</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">elem</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">    </span>
<span class="w">            </span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initVal</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>
<p>这样，当我们使用 <code>Container c1, c2(4), c3(6, 2);</code> 定义三个对象时，它们会分别使用无参、一个参数和两个参数的构造函数：</p>
<p><center><img alt="" src="../2023-03-03-14-45-31.png" /></center></p>
<p>事实上，不仅是构造函数支持重载，其他的成员函数或者独立的函数<sup id="fnref:namespace-scope"><a class="footnote-ref" href="#fn:namespace-scope">18</a></sup>也支持重载。例如<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/over.pre#2">over.pre#2</a></sup>：</p>
<div class="highlight"><pre><span></span><code><span class="kt">double</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="kt">double</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

<span class="n">abs</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">             </span><span class="c1">// calls abs(int);</span>
<span class="n">abs</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span><span class="w">           </span><span class="c1">// calls abs(double);</span>
</code></pre></div>
<p>如果一个名字引用多个函数，则称它是 overloaded 的。当使用这样的名字的时候，编译器用来决定使用哪个；这个过程称为 <strong>重载解析 (overload resolution)</strong>。简单来说，重载解析首先收集这个名字能找到的函数形成候选函数集 (candidate functions)，然后检查参数列表来形成可行函数集 (viable functions)，然后在可行函数集中按照一定的规则比较这些函数，如果 <strong>恰好</strong> 有一个函数 (best viable function) 优于其他所有函数，则重载解析成功并调用此函数；否则编译失败。</p>
<p>上面的「规则」比较复杂<sup id="fnref:overload_resolution"><a class="footnote-ref" href="#fn:overload_resolution">19</a></sup>，但是一个简单的例子是，不需要类型转换的比需要的要好<sup id="fnref:rank_of_conversion"><a class="footnote-ref" href="#fn:rank_of_conversion">20</a></sup>：</p>
<p><center><img alt="" src="../2023-03-03-16-03-41.png" /></center></p>
<p>因此，上面第 5 行的 <code>f(0L);</code> 中 <code>0L</code> 是 <code>long</code> 类型的字面量，它调用 <code>void f(long)</code> 不需要转换，而调用 <code>void f(float)</code> 需要转换，因此选取前者。</p>
<p>但是，上面第 6 行的 <code>f(0);</code> 中 <code>0</code> 是 <code>int</code> 类型的字面量，它调用两个函数都需要转换，且两个转换没有一个优于另一个<sup id="fnref2:rank_of_conversion"><a class="footnote-ref" href="#fn:rank_of_conversion">20</a></sup>，因此找不到 best viable function，因此编译错误。</p>
<p>也是因此，两个只有返回值类型不同的函数不是合法的重载，因为调用时没有办法完成重载解析：</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w">  </span><span class="c1">// error: functions that differ only in </span>
<span class="w">                </span><span class="c1">// their return type cannot be overloaded</span>
</code></pre></div>
<p>我们会在后面的章节具体讨论重载解析的细节。</p>
<div class="admonition note">
<p class="admonition-title">nullptr</p>
<p>我们在前面的章节看到了 <code>nullptr</code>，这是 C++11 引入的一个关键字，用来表示空指针。</p>
<p>为什么要引入这个东西呢？我们首先要提到一个事实：为了类型安全，C++ 不允许 <code>void*</code> 隐式转换到其他指针类型。因此，如果我们将 <code>NULL</code> 定义为 <code>(void*) 0</code>，那么 <code>int * p = NULL;</code> 会引发编译错误：</p>
<p><center><img alt="" src="../2023-03-03-16-20-49.png" /></center></p>
<p>（这是 C++ 与 C 不兼容的例子之一。）</p>
<p>既然 C++ 不允许将 <code>(void*) 0</code> 当空指针，那么我们用什么表示空指针呢？在 C++11 之前，空指针常量 (null pointer constant) 是值为 0 的整型字面量<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/conv.ptr#1">conv.ptr#1</a></sup>。</p>
<p>因此，如果我们将 <code>NULL</code> 定义为 <code>0</code>，则 <code>int * p = NULL;</code> 即 <code>int * p = 0;</code> 是合法的（赋值成其他整数是不合法的）。</p>
<p>但是！问题来了——</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

<span class="cp">#define NULL 0</span>
<span class="n">f</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span><span class="w">   </span><span class="c1">// ==&gt; f(0) , so f(int) is called</span>
</code></pre></div>
<p>可以看到，重载使得上面的情况可能引起误解，造成意料之外的结果。</p>
<p>因此，C++11 引入了 <code>nullptr</code> 来表示空指针常量。这样就解决了上面的问题：</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

<span class="n">f</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span><span class="w">   </span><span class="c1">// f(int *) is called</span>
</code></pre></div>
<p>因为 null pointer constant 可以转换到任意指针类型<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/conv.ptr#1">conv.ptr#1</a></sup>。</p>
<p>当然，为了兼容，值为 0 的整型字面量仍然是空指针常量。</p>
</div>
<p>考虑函数重载和默认参数共同使用的情况，事实上仍然能通过上面「重载解析」的方式处理：</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">();</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">   </span><span class="c1">// OK, call the first one</span>
<span class="w">    </span><span class="n">f</span><span class="p">();</span><span class="w">    </span><span class="c1">// Error: ambiguous</span>
<span class="p">}</span>
</code></pre></div>
<p>不过我们可能会发现，函数重载的作用已经足以覆盖默认参数的作用。事实上确实如此：默认参数机制在 C with Classes 时就存在了，其意义就是前面给出的构造函数中默认参数的例子；而一般的函数重载直到 Release 1.0 才被引入。默认参数机制是重载机制的前驱之一；重载机制的另一个前驱是 <code>operator =</code> 的重载，我们会在后面的章节看到它。</p>
<div class="admonition info">
<p class="admonition-title">重载如何处理链接问题</p>
<p>一种实现是，将 <code>void foo(int i);</code> 产生的函数名字称为 <code>foo_Fi</code>，<code>void foo(int i, char *j);</code> 产生的函数名字称为 <code>foo_FiPc</code> 之类的。这同时能够完成在链接时的类型安全检查。另一方面，为了和 C 链接，C++ 引入了扩充 <code>extern "C" { ... }</code>，从而告诉编译器在这些部分采用 C 的命名习惯。</p>
</div>
<h2 id="43-构造函数-cont">4.3 构造函数 (Cont.)<a class="headerlink" href="#43-构造函数-cont" title="Permanent link">&para;</a></h2>
<p>关于构造函数，我们还有几个问题可以讨论！</p>
<h3 id="implicitly-declared-default-constructor">implicitly-declared default constructor<a class="headerlink" href="#implicitly-declared-default-constructor" title="Permanent link">&para;</a></h3>
<p>我们称一个能够无参调用的构造函数是 default constructor。即，它不接收任何参数，或者所有参数都有默认值。</p>
<p>有一个问题是，我们在讲构造函数之前的代码里都没有写构造函数，但是它们也能正常编译运行！C++ 也希望在没有必要的理由时不与 C 发生不兼容，而 C 中的 struct 也没有写构造函数，但是它们也能被运行。这是怎么回事呢？</p>
<p>事实上，对于一个类，如果用户没有提供任何构造函数，则编译器会自动为这个类创建一个 public 的 implicitly-declared default constructor，它被定义为 defaulted。Defaulted 的构造函数不接收任何参数，也什么都不做。如果有任何用户提供的构造函数<sup id="fnref:default_ctor"><a class="footnote-ref" href="#fn:default_ctor">21</a></sup>，则 defaulted default constructor 被定义为 deleted 的。deleted 的函数不能被调用。</p>
<p>不过，如果用户提供了构造函数，他仍然可以用 <code>ClassName() = default;</code> 来引入 defaulted 的构造函数。</p>
<p>用户还可以通过 <code>ClassName() = delete;</code> 显式地将 default constructor 设置成 deleted 的。</p>
<h3 id="member-initializer-lists">member initializer lists<a class="headerlink" href="#member-initializer-lists" title="Permanent link">&para;</a></h3>
<div class="admonition success">
<p class="admonition-title">总结</p>
<p>如果您并非初学者，<a href="../summaries/member_init_lists/">这里</a> 有关于该话题更详尽的总结。</p>
</div>
<p>一个问题是这样的：假如我们希望根据构造函数的一些参数来初始化一些成员，我们固然可以这样写：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">failTimes</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">User</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">pw</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<span class="w">        </span><span class="n">failTimes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copyStr</span><span class="p">(</span><span class="n">pw</span><span class="p">);</span><span class="w"> </span><span class="c1">// assume that `copyStr` gets a string and allocate some space and copy it</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>但是这样很累！于是 C++ 允许这样的写法：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">failTimes</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">User</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">pw</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">age</span><span class="p">),</span><span class="w"> </span><span class="n">failTimes</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">password</span><span class="p">(</span><span class="n">copyStr</span><span class="p">(</span><span class="n">pw</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>构造函数定义中形如 <code>: member(expr), member(expr)</code> 的东西叫做 member initializer lists<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class#base.init-1">class#base.init-1</a></sup>，用来指明成员变量的初始化器 (initializer)。这些初始化会在构造函数的函数体执行之前完成。</p>
<p>在一些情况下，member initializer lists 是必要的。例如：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Point</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Point</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">};</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Circle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Point</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Circle</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">cx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">cy</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">c</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="w"> </span><span class="n">cy</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>C++ 规定，在构造函数的函数体执行之前，所有参数要么按照 member initializer lists 的描述初始化，要么以默认方式初始化<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.base.init#13">class.base.init#13</a></sup>。而对于类的对象，「默认方式初始化」意味着使用 default constructor 构造。然而，<code>Point</code> 类并没有 default constructor，因此如果 member initializer lists 没有指明 <code>Point</code> 类的初始化方式，就会出现编译错误：</p>
<p><center><img alt="" src="../2023-03-04-03-11-28.png" /></center></p>
<p>在后面的章节中，我们还会看到更多 member initializer lists 是必要的的情况。</p>
<details class="note" open="open">
<summary>补充</summary>
<p>如果构造函数的声明和定义分离，则 member initializer lists 应当出现在构造函数的定义中。</p>
<p>member initializer list 的顺序不影响成员被初始化的顺序，它们按照在类定义中的顺序初始化。例如：</p>
<p><center><img alt="" src="../2023-03-04-03-20-24.png" /></center></p>
</details>
<h4 id="delegating-constructor">delegating constructor<a class="headerlink" href="#delegating-constructor" title="Permanent link">&para;</a></h4>
<p>member initializer list 可以将构造委托给同一类型的另一个构造函数，做出这一委托的构造函数称为 delegating constructor；如果这样的话，member initializer list 应当只包含这一个项目。目标构造函数由重载解析选取，其运行结束后，delegating constructor 的函数体被执行<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.base.init#6">class.base.init#6</a></sup>。一个构造函数不能直接或间接地被委托给自己。</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">C</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">C</span><span class="p">(</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">                  </span><span class="c1">// #1: non-delegating constructor</span>
<span class="w">    </span><span class="n">C</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">                </span><span class="c1">// #2: delegates to #1</span>
<span class="w">    </span><span class="n">C</span><span class="p">(</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="mf">42.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">     </span><span class="c1">// #3: ill-formed due to recursion with #4</span>
<span class="w">    </span><span class="n">C</span><span class="p">(</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">C</span><span class="p">(</span><span class="sc">&#39;a&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w">    </span><span class="c1">// #4: ill-formed due to recursion with #3</span>
<span class="p">};</span>
</code></pre></div>
<p><center><img alt="" src="../2023-03-04-03-15-43.png" /></center></p>
<p>可见，被委托的目标构造函数运行完输出 <code>ctor1 called</code> 后，委托构造函数运行，输出 <code>ctor2 called</code>。</p>
<h3 id="default-member-initializer">default member initializer<a class="headerlink" href="#default-member-initializer" title="Permanent link">&para;</a></h3>
<p>假设我们有若干个构造函数：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">failTimes</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">password</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">User</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">pw</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">age</span><span class="p">),</span><span class="w"> </span><span class="n">failTimes</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">password</span><span class="p">(</span><span class="n">copyStr</span><span class="p">(</span><span class="n">pw</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="n">User</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">age</span><span class="p">),</span><span class="w"> </span><span class="n">failTimes</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">password</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="n">User</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="mi">-1</span><span class="p">),</span><span class="w"> </span><span class="n">failTimes</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">password</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>可以看到，我们也许想要给构造时没有提供的参数赋一个初值；如果在构造函数或者 member initializer list 中写初始值，则所有构造函数都要写一份，这是比较累的！于是，C++11 引入了 default member initializer 解决这个问题！</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="n">failTimes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">User</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">pw</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">age</span><span class="p">),</span><span class="w"> </span><span class="n">password</span><span class="p">(</span><span class="n">copyStr</span><span class="p">(</span><span class="n">pw</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="n">User</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="n">User</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">id</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>如果一个成员变量同时被 member initializer list 指定且有 default member initializer，按前者执行，后者被忽略。</p>
<p>default member initializer 只允许 <code>brace-or-equal-initializer</code> 即 <code>= something</code> 或者 <code>{ something }</code>，而不允许用括号的形式<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.mem.general#nt:member-declarator">class.mem.general#nt:member-declarator</a></sup>。<code>{ something }</code> 是我们之前提到的 brace initialization (uniform initialization)，我们在后面的章节具体讨论。</p>
<p>也就是说，含 default member initializer 的成员可以形如 <code>Foo f = Foo(...);</code>，但不能形如 <code>Foo f(...);</code>：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Point</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Point</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">};</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Circle</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Point c(0, 0);       // error</span>
<span class="w">    </span><span class="n">Point</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">  </span><span class="c1">// OK</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Circle</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">cx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">cy</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">c</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="w"> </span><span class="n">cy</span><span class="p">),</span><span class="w"> </span><span class="n">r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<h2 id="44-析构函数">4.4 析构函数<a class="headerlink" href="#44-析构函数" title="Permanent link">&para;</a></h2>
<p>我们考虑这样一个问题：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Container</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">elem</span><span class="o">*</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Container</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">elem</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p><code>Container</code> 的每个对象都会 <code>malloc</code> 一块内存。众所周知，<code>malloc</code> 出来的空间需要我们在不用的时候手动 <code>free</code> 来回收。那么什么时候完成这个回收呢？最好的选择显然是当对象的生命周期结束的时候。生命周期结束意味着这个对象再也无法被访问，因此它的成员自然也无法被访问；在这个时候我们将它所拥有的资源（即指针成员变量指向的 <code>malloc</code> 出来的内存）释放，既不会太早（因为后面不会再有使用了），也不会太晚（因为此时仍然能知道那些资源的地址）。</p>
<p>因此，C++ 引入了 <strong>析构函数 (destructors)</strong> 来解决这个问题；析构函数在每个对象的生命周期结束的时候被调用，大多数情况被用来释放对象在运行过程中可能获取的资源，例如释放申请的内存、关闭打开的文件等。我们稍后讨论各种变量的生命周期。析构函数形如 <code>~class-name()</code>，其中 <code>~</code> 也被用作取反运算符，这里来表示「与构造相反」的含义，即析构。一个例子是：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Container</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">elem</span><span class="o">*</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="n">Container</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">elem</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">~</span><span class="n">Container</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">free</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div></td></tr></table></div>
<p>9~11 行是析构函数。这里，析构函数将 <code>val</code> 指向的内存释放。</p>
<p>析构函数的参数列表永远是空的。显然，析构函数是无法重载的。</p>
<p>析构函数和构造函数一样，如果某个类没有 user-declared destructor，编译器会自动生成一个 public 的 implicitly-declared destructor，定义为 defaulted。因此，当类的成员中没有什么需要释放的资源时，我们就不需要写析构函数了<sup id="fnref:rule_of_zero"><a class="footnote-ref" href="#fn:rule_of_zero">22</a></sup>。</p>
<p>析构函数 destructor 也经常被简写为 dtor 或 d'tor 等。</p>
<p>当然，自 C++11 起，我们仍然可以通过 <code>= default;</code> 或者 <code>= delete;</code> 来生成默认的析构函数，或者删除 implicitly-declared destructor。例如：</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
<span class="w">    </span><span class="o">~</span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>这里我们告知编译器在 <code>private</code> 范围内显式生成了默认的构造函数。</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">~</span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>这里我们将 implicitly-declared destructor 标记为 deleted。</p>
<p>如果 <code>Foo</code> 的析构函数是 deleted 的，或者在当前位置不可访问 (如当前在类外，但是析构函数是 private 的)，那么类似 <code>Foo f;</code> 的全局变量、局部变量或者成员变量定义是非法的<sup id="fnref:private_or_deleted_dtor"><a class="footnote-ref" href="#fn:private_or_deleted_dtor">23</a></sup>。但是，这种情况下，可以通过 <code>new</code> 来创建一个动态的对象，因为这样创建的对象并不隐式地在同一个作用域内调用析构函数。</p>
<p>与构造函数不同，析构函数是可以手动调用的。我们在后面讨论 placement new 的章节讨论这个问题<sup id="fnref:call_dtor"><a class="footnote-ref" href="#fn:call_dtor">24</a></sup>。</p>
<details class="note">
<summary>defaulted ctor &amp; dtor 被 delete 的情况</summary>
<p>考虑这个问题：</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="p">){}</span><span class="w"> </span><span class="p">};</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Bar</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</code></pre></div>
<p>即，<code>Foo</code> 类型没有 default constructor（即可以无参调用的构造函数）；而 <code>Bar</code> 类型中有一个 <code>Foo</code> 类型的子对象 <code>f</code>。<code>Bar</code> 类型并没有提供构造函数。</p>
<p>根据我们所说，如果没有提供构造函数，则编译器自动生成一个 implicitly-declared default constructor；但是这里自动生成的构造函数并不能完成 <code>f</code> 的初始化。这种情况怎么办呢？</p>
<p>类似地，考虑以下几个场景：</p>
<p><code>Foo</code> 的默认构造函数是有歧义的：</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">Foo</span><span class="p">(){}</span>
<span class="w">    </span><span class="n">Foo</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">){}</span>
<span class="p">};</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Bar</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</code></pre></div>
<p><code>Foo</code> 的析构函数是 deleted 的：</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">~</span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Bar</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</code></pre></div>
<p><code>Foo</code> 的析构函数是 private 的：</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">~</span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Bar</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</code></pre></div>
<p>或者，这个问题可以对称延伸到析构函数：</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">~</span><span class="n">Foo</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Bar</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="n">Bar</span><span class="p">(){}</span>
<span class="p">};</span>
</code></pre></div>
<p>C++ 规定，当以下任一情况发生时，其 defaulted 的 default constructor 被定义为 deleted 的<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.default.ctor#2">class.default.ctor#2</a></sup>：</p>
<ul>
<li>某个没有 default member initializer 的 subobject 没有 default constructor</li>
<li>对某个 subobject 的对应 constructor 的重载解析得到歧义，或者解析出的函数是被删除或在此处不可访问的</li>
<li>某个 subobject 的 destructor 是被删除或者在此处不可访问的</li>
<li>（其他情况略）</li>
</ul>
<p>同时，如果某个 subobject 的 destructor 是被删除或者在此处不可访问的，其 defaulted 的 dtor 被定义为 deleted 的<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.dtor#7">class.dtor#7</a></sup>。</p>
</details>
<h2 id="45-构造和析构的时机和顺序">4.5 构造和析构的时机和顺序<a class="headerlink" href="#45-构造和析构的时机和顺序" title="Permanent link">&para;</a></h2>
<p>对于一个类对象，它的 <strong>生命周期 (lifetime)</strong> 自它的初始化（构造）完成开始，到它的析构函数调用被启动为止。</p>
<p>任何一个对象都会占据一部分存储；这部分存储的最小生命周期称为这个对象的 <strong>storage duration</strong>。对象的 lifetime 等于或被包含于其 storage duration。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>这里说「最小生命周期」，是因为对象被析构后，对应的存储虽然可以被立刻回收，但也不一定立刻被回收。但「最小」提供的是一种保证。</p>
</div>
<p>在 C++11 之前，任何一个对象的 storage duration 都是如下一种<sup id="fnref:thread_storage_duration"><a class="footnote-ref" href="#fn:thread_storage_duration">25</a></sup>：</p>
<ul>
<li><strong>automatic</strong> storage duration: 没有被定义为 <code>static</code><sup id="fnref:auto"><a class="footnote-ref" href="#fn:auto">26</a></sup> 的局部对象。<sup id="fnref:auto_opt"><a class="footnote-ref" href="#fn:auto_opt">27</a></sup></li>
<li><strong>static</strong> storage duration: non-local 对象，或者被定义为 <code>static</code> 的局部对象或者类成员对象。我们会在后面的章节讨论 <code>static</code> 成员对象。</li>
<li><strong>dynamic</strong> storage duration: <code>new</code> 出来的对象。</li>
</ul>
<p>子对象 (subobject，如成员变量) 的 storage duration 是它所在的对象的 storage duration。</p>
<p>在下面的情况下，构造函数会被调用：</p>
<ul>
<li>对于全局对象，在 <code>main()</code> 函数运行之前，或者在同一个编译单元<sup id="fnref:trans_units"><a class="footnote-ref" href="#fn:trans_units">28</a></sup>内定义的任一函数或对象被使用之前。在同一个编译单元内，它们的构造函数按照声明的顺序初始化<sup id="fnref:static_init"><a class="footnote-ref" href="#fn:static_init">29</a></sup>。</li>
<li>对于 static local variables，在第一次运行到它的声明的时候<sup id="fnref:static_local"><a class="footnote-ref" href="#fn:static_local">30</a></sup>。</li>
<li>对于 automatic storage duration 的对象，在其声明被运行时。</li>
<li>对于 dynamic storage duration 的对象，在其用 <code>new</code> 表达式创建时。</li>
</ul>
<p>在下面的情况下，析构函数会被调用：</p>
<ul>
<li>对于 static storage duration 的对象，在程序结束时，按照与构造相反的顺序。</li>
<li>对于 automatic storage duration 的对象，在所在的 block 退出时，按照与构造相反的顺序。</li>
<li>对于 dynamic storage duration 的对象，在 <code>delete</code> 表达式中。</li>
<li>对于临时对象，当其生命周期结束时。我们会在后面的章节讨论临时对象及其生命周期。</li>
</ul>
<p>数组元素的析构函数调用顺序与其构造顺序相反。</p>
<p><img alt="" src="../2023-03-05-19-26-59.png" /></p>
<p>类的成员的析构函数调用顺序也与其构造顺序相反。类的成员的构造顺序依照它们在类定义中声明出现的顺序，而与 member initializer list 中的顺序无关。这样设计的原因是，不同的构造函数的 member initializer list 中成员顺序可能不同；如果依照 member initializer list 的顺序构造，那么析构时就很难保证和构造顺序相反。</p>
<p>作为一个练习，请说明下面的代码的输出：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Count</span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="o">~</span><span class="n">Count</span><span class="p">();</span>

<span class="w">    </span><span class="n">Count</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">getS</span><span class="p">(){</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">sPlus</span><span class="p">(){</span>
<span class="w">        </span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="n">Count</span><span class="o">::~</span><span class="n">Count</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">s</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;}</span>

<span class="n">Count</span><span class="w"> </span><span class="n">count5</span><span class="p">(</span><span class="mi">555</span><span class="p">);</span>
<span class="k">static</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="nf">count6</span><span class="p">(</span><span class="mi">666</span><span class="p">);</span>
<span class="n">Count</span><span class="w"> </span><span class="nf">count7</span><span class="p">(</span><span class="mi">777</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(){</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="n">count9</span><span class="p">(</span><span class="mi">999</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Count</span><span class="w"> </span><span class="o">*</span><span class="n">count1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Count</span><span class="p">(</span><span class="mi">111</span><span class="p">);</span>
<span class="w">    </span><span class="n">Count</span><span class="w"> </span><span class="o">*</span><span class="n">count2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Count</span><span class="p">(</span><span class="mi">222</span><span class="p">);</span>

<span class="w">    </span><span class="n">Count</span><span class="w"> </span><span class="n">count3</span><span class="p">(</span><span class="mi">333</span><span class="p">);</span>
<span class="w">    </span><span class="n">Count</span><span class="w"> </span><span class="n">count4</span><span class="p">(</span><span class="mi">444</span><span class="p">);</span>

<span class="w">    </span><span class="n">f</span><span class="p">();</span>

<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="n">count8</span><span class="p">(</span><span class="mi">888</span><span class="p">);</span>

<span class="w">    </span><span class="k">delete</span><span class="p">(</span><span class="n">count1</span><span class="p">);</span>

<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="n">Count</span><span class="w"> </span><span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">getS</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">sPlus</span><span class="p">());</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>答案是 <code>111 2 3 4 5 6 444 333 888 999 777 666 555</code>。</p>
<h2 id="46-小结">4.6 小结<a class="headerlink" href="#46-小结" title="Permanent link">&para;</a></h2>
<ul>
<li>类的定义<ul>
<li>定义引入新的类型</li>
<li>class-key 通常不必要</li>
</ul>
</li>
<li>声明和定义<ul>
<li>定义是声明的一种</li>
</ul>
</li>
<li>类的成员<ul>
<li>type alias</li>
<li><code>this</code></li>
</ul>
</li>
<li>函数内联</li>
<li>构造函数<ul>
<li>建立起某种「保证」</li>
<li>如何无参或有参地构造对象</li>
<li><code>new</code>, <code>delete</code>, <code>new[]</code>, <code>delete[]</code></li>
<li>implicitly-declared default constructor</li>
<li><code>= default;</code>, <code>= delete</code></li>
<li>member initializer lists</li>
<li>delegating constructor</li>
<li>default member initializer</li>
</ul>
</li>
<li>函数默认参数和函数重载<ul>
<li>重载解析</li>
<li>为什么 C++ 引入了 <code>nullptr</code></li>
</ul>
</li>
<li>析构函数<ul>
<li>用来回收资源</li>
<li>为什么析构函数无法重载</li>
</ul>
</li>
<li>构造和析构的时机和顺序<ul>
<li>lifetime</li>
<li>storage duration<ul>
<li>automatic</li>
<li>static</li>
<li>dynamic</li>
</ul>
</li>
<li>构造和析构的时机和顺序</li>
</ul>
</li>
</ul>
<hr />
<script>
function inFootnote(element) {
    let parent = element.parentNode;
    while (parent !== null) {
      if (parent.classList && parent.classList.contains("footnote")) {
        break;
      }
      parent = parent.parentNode;
    }
    return parent !== null;
}
</script>
<script>
function toggleVisibility() {
  const links = document.querySelectorAll('a');
  const buttons = document.querySelectorAll('.xyx-toggle');
  links.forEach(link => {
    if (!link.classList.contains('md-nav__link') &&
        !link.classList.contains('md-tabs__link') &&
        !link.classList.contains('md-source') &&
        !link.classList.contains('md-header__button') &&
        !link.closest('.md-nav__link') &&
        !link.closest('.md-tabs__link') &&
        !link.closest('.md-source') &&
        !link.closest('.footnote-backref') &&
        !link.closest('.footnote-ref') &&
        !link.closest('.md-header__button') &&
        !inFootnote(link)
        ) {
      if (link.style.display === 'none') {
        link.style.display = 'inline';
        for (const button of buttons) {
            button.innerHTML = '点击此处隐藏正文所有链接';
        }
      } else {
        link.style.display = 'none';
        for (const button of buttons) {
            button.innerHTML = '点击此处显示正文所有链接';
        }
      }
    }
  });
}
</script>
<script>
function toggleVisibilityFoot() {
  const links = document.querySelectorAll('a');
  const buttons = document.querySelectorAll('.xyx-toggle2');
  links.forEach(link => {
    if (link.closest('.footnote-backref') ||
        link.closest('.footnote-ref')) {
      if (link.style.display === 'none') {
        link.style.display = 'inline';
        for (const button of buttons) {
            button.innerHTML = '点击此处隐藏本文所有脚注';
        }
      } else {
        link.style.display = 'none';
        for (const button of buttons) {
            button.innerHTML = '点击此处显示本文所有脚注';
        }
      }
    }
  });

  const footnotes = document.querySelectorAll('.footnote');
  for (const footnote of footnotes) {
    if (footnote.style.display === 'none') {
      footnote.style.removeProperty('display');
    } else {
      footnote.style.display = 'none';
    }
  }
}
</script>

<p><center>
<button onclick="toggleVisibility()" class="box box-yellow xyx-toggle">点击此处隐藏正文所有链接</button>
<button onclick="toggleVisibilityFoot()" class="box box-green xyx-toggle2">点击此处隐藏本文所有脚注</button>
</center></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:std_version">
<p>本文所参考的 standard 版本是 N4868 (October 2020 pre-virtual-plenary working draft/C++20 plus editorial changes)，这并不是最新的版本。参考该版本的主要考量是防止可能的更新导致链接失效。&#160;<a class="footnote-backref" href="#fnref:std_version" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:class-specifier">
<p>class-specifier 在这里用到：<a href="https://timsong-cpp.github.io/cppwp/n4868/dcl.type.general#1">dcl.type.general#1</a>&#160;<a class="footnote-backref" href="#fnref:class-specifier" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:class-name">
<p>class-name 还可能是一个 simple-template-id，即模板特化。&#160;<a class="footnote-backref" href="#fnref:class-name" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:refer_to_same">
<p>如果将代码中 L7 提到 L5 之前，GCC 会出现报错。这是因为：<a href="https://timsong-cpp.github.io/cppwp/n4868/basic.scope.class#2">basic.scope.class#2</a>: A name N used in a class S shall refer to the same declaration in its context and when re-evaluated in the completed scope of S. No diagnostic is required for a violation of this rule.&#160;<a class="footnote-backref" href="#fnref:refer_to_same" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:nonzero_size">
<p>关于输出中的 1：<a href="https://timsong-cpp.github.io/cppwp/n4868/class.pre#6">class.pre#6</a>: Complete objects of class type have nonzero size. Base class subobjects and members declared with the no_­unique_­address attribute are not so constrained.&#160;<a class="footnote-backref" href="#fnref:nonzero_size" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
<li id="fn:structural">
<p>但 layout capability rules 允许了 low-level 的强转。&#160;<a class="footnote-backref" href="#fnref:structural" title="Jump back to footnote 6 in the text">&#8617;</a></p>
</li>
<li id="fn:noexcept-specifier">
<p>还有 noexcept-specifier&#160;<a class="footnote-backref" href="#fnref:noexcept-specifier" title="Jump back to footnote 7 in the text">&#8617;</a></p>
</li>
<li id="fn:scope">
<p>注意，作用域定义为「the largest part of the program in which that name is valid, that is, in which that name may be used as an <strong>unqualified name</strong> to refer to the same entity<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/basic.scope.declarative#1">basic.scope.declarative#1</a></sup>.」&#160;<a class="footnote-backref" href="#fnref:scope" title="Jump back to footnote 8 in the text">&#8617;</a></p>
</li>
<li id="fn:redeclaration">
<p>见问题： <a href="https://stackoverflow.com/questions/75402077/which-subclause-of-c-standard-prohibits-redeclaration-redefinition-in-a-same">Which subclause of C++ standard prohibits redeclaration / redefinition in a same block?</a>，已经解决。&#160;<a class="footnote-backref" href="#fnref:redeclaration" title="Jump back to footnote 9 in the text">&#8617;</a></p>
</li>
<li id="fn:class-scope">
<p>在 N4868 里，这里解释为：当一个名字在类内被定义后，类内的剩余部分<sup><a href="https://timsong-cpp.github.io/cppwp/n4868/basic.scope.pdecl#6">basic.scope.pdecl#6</a></sup>及该类的成员函数的函数体、default argument 以及 default member initializer（后两者会在后面讲解）<sup id="fnref:noexcept-specifier"><a class="footnote-ref" href="#fn:noexcept-specifier">7</a></sup><sup><a href="https://timsong-cpp.github.io/cppwp/n4868/class.mem.general#6">class.mem.general#6</a></sup>成为其作用域<sup id="fnref:scope"><a class="footnote-ref" href="#fn:scope">8</a></sup><sup><a href="https://timsong-cpp.github.io/cppwp/n4868/basic.scope.class#1">basic.scope.class#1</a></sup>。在最新版（写本文时，为 2023-01-02）中，scope 的定义发生了较大更改。&#160;<a class="footnote-backref" href="#fnref:class-scope" title="Jump back to footnote 10 in the text">&#8617;</a></p>
</li>
<li id="fn:name_hiding">
<p>在最新版本里，name hiding 一节也没有了。可以在 <a href="https://timsong-cpp.github.io/cppwp/basic.scope.pdecl#2">basic.scope.pdecl#2</a> 找到相关描述。&#160;<a class="footnote-backref" href="#fnref:name_hiding" title="Jump back to footnote 11 in the text">&#8617;</a></p>
</li>
<li id="fn:class_member">
<p>还能有 using-declarations, static_assert declarations, member template declarations, deduction guides (C++17), Using-enum-declarations (C++20)&#160;<a class="footnote-backref" href="#fnref:class_member" title="Jump back to footnote 12 in the text">&#8617;</a></p>
</li>
<li id="fn:this">
<p>implicit object parameter 的实际用途是重载解析，无论是否 static 都会被视为有这个成员，见 <a href="https://stackoverflow.com/a/72534617/14430730">这个回答</a>。但是 static 成员函数没有 <code>this</code>。只有构造函数没有 implicit object parameter。&#160;<a class="footnote-backref" href="#fnref:this" title="Jump back to footnote 13 in the text">&#8617;</a></p>
</li>
<li id="fn:redecl">
<p>或者成员函数模板的显式特化。&#160;<a class="footnote-backref" href="#fnref:redecl" title="Jump back to footnote 14 in the text">&#8617;</a></p>
</li>
<li id="fn:copy_ctor">
<p>部分对 C++ 有基础了解的读者可能会认为，用这里返回的临时对象来构造 <code>c1</code> 或者 <code>c2</code> 时有可能调用拷贝构造函数。这在早期 C++ 中是有可能的，但是自 C++17 强制 copy elision 之后拷贝构造函数的调用不会发生，即<code>Container()</code> 得到的是一个 prvalue，用这个 prvalue 去构造 <code>f</code> 时会出现 copy elision。事实上，在 C++17 之前，如果抑制 RVO，<code>Container f = Container();</code> 可能会触发一次构造和一次拷贝构造：<a href="https://godbolt.org/z/W55qWddM7">https://godbolt.org/z/W55qWddM7</a> 。因此，这里的构造必定等价于 <code>Container c1;</code> 和 <code>Container c2(64);</code>。我们会在讨论拷贝构造时讨论这个问题。&#160;<a class="footnote-backref" href="#fnref:copy_ctor" title="Jump back to footnote 15 in the text">&#8617;</a></p>
</li>
<li id="fn:initializer">
<p>还有 braced-init-list。我们在后面讨论。&#160;<a class="footnote-backref" href="#fnref:initializer" title="Jump back to footnote 16 in the text">&#8617;</a></p>
</li>
<li id="fn:equal-initializer">
<p>关于类使用 <code>Foo f = expr;</code> 形式的初始化的行为，我们在讨论完拷贝构造函数和转换构造函数之后再讨论。&#160;<a class="footnote-backref" href="#fnref:equal-initializer" title="Jump back to footnote 17 in the text">&#8617;</a></p>
</li>
<li id="fn:namespace-scope">
<p>准确地说，函数可以在 namespace scope 或者 class scope 被定义。这里没有引入 namespace 的概念所以暂时不用这个术语。&#160;<a class="footnote-backref" href="#fnref:namespace-scope" title="Jump back to footnote 18 in the text">&#8617;</a></p>
</li>
<li id="fn:overload_resolution">
<p><a href="https://en.cppreference.com/w/cpp/language/overload_resolution">Overload Resolution</a>, <a href="https://timsong-cpp.github.io/cppwp/n4868/over">over</a>&#160;<a class="footnote-backref" href="#fnref:overload_resolution" title="Jump back to footnote 19 in the text">&#8617;</a></p>
</li>
<li id="fn:rank_of_conversion">
<p>事实上，转换有三个等级，分别是 exact match, promotion 和 conversion。这里 int-&gt;long 和 int-&gt;float 都属于 conversion。参见<a href="https://en.cppreference.com/w/cpp/language/overload_resolution#Ranking_of_implicit_conversion_sequences">Ranking of implicit conversion sequences</a>&#160;<a class="footnote-backref" href="#fnref:rank_of_conversion" title="Jump back to footnote 20 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:rank_of_conversion" title="Jump back to footnote 20 in the text">&#8617;</a></p>
</li>
<li id="fn:default_ctor">
<p>如果有未指明初始化方式的引用成员、const 成员，或者 default ctor 被删除或不可访问的成员或基类等情况下，implicitly-declared default constructor 也是 deleted 的。&#160;<a class="footnote-backref" href="#fnref:default_ctor" title="Jump back to footnote 21 in the text">&#8617;</a></p>
</li>
<li id="fn:rule_of_zero">
<p><a href="https://en.cppreference.com/w/cpp/language/rule_of_three">The rule of three / five / zero</a> 一些讨论中涵盖了什么时候需要析构函数。我们会在后面的章节中具体讨论相关问题。&#160;<a class="footnote-backref" href="#fnref:rule_of_zero" title="Jump back to footnote 22 in the text">&#8617;</a></p>
</li>
<li id="fn:private_or_deleted_dtor">
<p>我们会在后面的章节讨论将析构函数设成 private 或者 delete 的场景。<a href="https://www.rangakrish.com/index.php/2020/03/04/deleted-destructor-in-c/">这篇文章</a> 给出了一些解释。&#160;<a class="footnote-backref" href="#fnref:private_or_deleted_dtor" title="Jump back to footnote 23 in the text">&#8617;</a></p>
</li>
<li id="fn:call_dtor">
<p><a href="https://stackoverflow.com/a/10082335/14430730">https://stackoverflow.com/a/10082335/14430730</a> 是一个很好的例子，讨论容器中对 placement new 和手动调用析构函数的用途。&#160;<a class="footnote-backref" href="#fnref:call_dtor" title="Jump back to footnote 24 in the text">&#8617;</a></p>
</li>
<li id="fn:thread_storage_duration">
<p>自 C++11 开始，还有 thread storage duration，这里暂略。下面的讨论中也一样。&#160;<a class="footnote-backref" href="#fnref:thread_storage_duration" title="Jump back to footnote 25 in the text">&#8617;</a></p>
</li>
<li id="fn:auto">
<p>还有 <code>extern</code> 和 <code>thread_local</code>。<a href="https://timsong-cpp.github.io/cppwp/n4868/basic.stc.auto#1">basic.stc.auto#1</a>&#160;<a class="footnote-backref" href="#fnref:auto" title="Jump back to footnote 26 in the text">&#8617;</a></p>
</li>
<li id="fn:auto_opt">
<p><a href="https://timsong-cpp.github.io/cppwp/n4868/basic.stc.auto#3">basic.stc.auto#3</a> If a variable with automatic storage duration has initialization or a destructor with side effects, an implementation shall not destroy it before the end of its block nor eliminate it as an optimization, even if it appears to be unused, except that a class object or its copy/move may be eliminated as specified in [class.copy.elision].&#160;<a class="footnote-backref" href="#fnref:auto_opt" title="Jump back to footnote 27 in the text">&#8617;</a></p>
</li>
<li id="fn:trans_units">
<p>简单地说，一个编译单元是一个源代码文件完成编译预处理的结果。&#160;<a class="footnote-backref" href="#fnref:trans_units" title="Jump back to footnote 28 in the text">&#8617;</a></p>
</li>
<li id="fn:static_init">
<p>在这里，我们没有讨论跨编译单元的初始化顺序问题。这一问题有时比较重要，&#160;<a class="footnote-backref" href="#fnref:static_init" title="Jump back to footnote 29 in the text">&#8617;</a></p>
</li>
<li id="fn:static_local">
<p>这是线程安全的。这会带来额外的运行时开销，参见 <a href="https://stackoverflow.com/questions/23829389/does-a-function-local-static-variable-automatically-incur-a-branch">Does a function local static variable automatically incur a branch?</a>。&#160;<a class="footnote-backref" href="#fnref:static_local" title="Jump back to footnote 30 in the text">&#8617;</a></p>
</li>
</ol>
</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-03-10T05:48:49+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-03-10</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2023-02-08T16:33:32+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2023-02-08</span>
  </span>

    
    
    
  </aside>


  



<div id="__comments">

<h3>颜色主题调整</h3>

<!-- <div class="tx-switch">
<button data-md-color-scheme="default"><code>default</code></button>
<button data-md-color-scheme="slate"><code>slate</code></button>
</div>

<script>
var buttons = document.querySelectorAll("button[data-md-color-scheme]")
buttons.forEach(function(button) {
        button.addEventListener("click", function() {
        var attr = this.getAttribute("data-md-color-scheme")
        document.body.setAttribute("data-md-color-scheme", attr)
        localStorage.setItem("data-md-color-scheme",attr);
        updateScheme();
        })
})
</script> -->

<div class="tx-switch">
<button class="button1" data-md-color-primary="red" style="background-color:red">red</button>
<button class="button1" data-md-color-primary="pink" style="background-color:pink;color:black">pink</button>
<button class="button1" data-md-color-primary="purple" style="background-color:purple">purple</button>
<button class="button1" data-md-color-primary="indigo" style="background-color:indigo">indigo</button>
<button class="button1" data-md-color-primary="blue" style="background-color:blue">blue</button>
<button class="button1" data-md-color-primary="cyan" style="background-color:cyan;color:black">cyan</button>
<button class="button1" data-md-color-primary="teal" style="background-color:teal">teal</button>
<button class="button1" data-md-color-primary="green" style="background-color:green">green</button>
<button class="button1" data-md-color-primary="lime" style="background-color:lime;color:black">lime</button>
<button class="button1" data-md-color-primary="orange" style="background-color:orange;color:black">orange</button>
<button class="button1" data-md-color-primary="brown" style="background-color:brown;border-radius=3px">brown</button>
<button class="button1" data-md-color-primary="grey" style="background-color:grey">grey</button>
<button class="button1" data-md-color-primary="black" style="background-color:black">black</button>
<button class="button1" data-md-color-primary="white" style="background-color:white;color:black">white</button>
</div>

<script>
var buttons = document.querySelectorAll("button[data-md-color-primary]")
buttons.forEach(function(button) {
        button.addEventListener("click", function() {
        var attr = this.getAttribute("data-md-color-primary")
        document.body.setAttribute("data-md-color-primary", attr)
        localStorage.setItem("data-md-color-primary",attr);
        })
})
</script>

<h2 ><!-- 评论 -->评论区~</h2>

有用的话请给我个赞和 star => <a href="https://github.com/xuan-insr/xuan-insr.github.io"><img alt="GitHub stars" src="https://img.shields.io/github/stars/xuan-insr/xuan-insr.github.io.svg?style=plastic&amp;label=Stars"></a>

</br>

快来跟我聊天~

</div>

<script src="https://giscus.app/client.js"
        data-repo="xuan-insr/discussion"
        data-repo-id="R_kgDOIUW7XA"
        data-category="General"
        data-category-id="DIC_kwDOIUW7XM4CSOC3"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="dark"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>

updateScheme();

</script>

<!-- Synchronize Giscus theme with palette -->
<script>
var giscus = document.querySelector("script[src*=giscus]")

/* Set palette on initial load */
var palette = __md_get("__palette")
if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate" ? "dark" : "light"
    giscus.setAttribute("data-theme", theme) 
}

/* Register event handlers after documented loaded */
document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        localStorage.setItem("data-md-color-scheme", palette.color.scheme === "slate" ? "slate" : "default");
        /* Instruct Giscus to change theme */
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
        { giscus: { setConfig: { theme } } },
        "https://giscus.app"
        )
    }
    })
})
</script>
                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      本页面的全部内容在 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC BY-SA 4.0</a> 和 <a href="https://github.com/zTrix/sata-license">SATA</a> 协议之条款下提供，附加条款亦可能应用
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/smd1121" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:xianyuxuan@outlook.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "content.code.annotate", "navigation.indexes", "navigation.top", "toc.follow"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.5cfa9459.min.js"></script>
      
        <script src="../../../js/timeago.min.js"></script>
      
        <script src="../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../../from_oi_wiki/js/extra.js"></script>
      
        <script src="../../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../../js/tablesort.js"></script>
      
        <script src="../../../termynal.js"></script>
      
    
  </body>
</html>